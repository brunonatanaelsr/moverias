{% extends 'base_optimized.html' %}
{% load static %}

{% block extra_css %}
<style>
    :root {
        --move-purple: #6c3eb6;
        --move-pink: #e83e8c;
        --move-orange: #ff9800;
        --move-green: #22c55e;
        --move-blue: #2563eb;
    }
    /* Dashboard specific animations */
    .dashboard-fade-in {
        animation: fadeIn 0.4s ease-out;
    }
    
    .dashboard-slide-up {
        animation: slideUp 0.5s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from { 
            opacity: 0;
            transform: translateY(15px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Hover effects */
    .dashboard-card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
    }
    .loading-spinner {
        border: 2px solid #fff;
        border-top: 2px solid var(--move-purple);
        border-radius: 50%;
        width: 20px;
        height: 20px;
        animation: spin 0.8s linear infinite;
        display: inline-block;
        vertical-align: middle;
    }
    @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    .tooltip-box {
        position: absolute;
        background: #333;
        color: #fff;
        padding: 4px 8px;
        border-radius: 4px;
        font-size: 12px;
        z-index: 1000;
        box-shadow: 0 2px 8px rgba(0,0,0,0.15);
    }
</style>
{% endblock %}

{% load static %}

{% block page_title %}Dashboard de Comunicação{% endblock %}

{% block breadcrumbs %}
    <nav class="flex" aria-label="Breadcrumb">
        <ol class="flex items-center space-x-4">
            <li>
                <div>
                    <a href="{% url 'dashboard:home' %}" class="text-gray-400 hover:text-gray-500">
                        <i class="fas fa-home h-5 w-5"></i>
                    </a>
                </div>
            </li>
            <li>
                <div class="flex-center">
                    <i class="fas fa-chevron-right h-5 w-5 text-gray-400"></i>
                    <span class="ml-4 text-sm font-medium text-gray-500">Comunicação</span>
                </div>
            </li>
        </ol>
    </nav>
{% endblock %}

{% block breadcrumb_items %}
<!-- Add breadcrumb items here if needed -->
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
<div class="space-y-6">
        <!-- Header -->
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-2xl font-bold" style="color:var(--move-purple)">
                        <i class="fas fa-bullhorn mr-3" style="color:var(--move-purple)"></i>
                        Dashboard de Comunicação
                    </h1>
                    <p class="mt-1" style="color:var(--move-blue)">Gerencie campanhas, comunicados e engajamento</p>
                </div>
                <div class="flex space-x-3">
                    <a href="{% url 'communication:announcement_create' %}" 
                       class="inline-flex items-center px-4 py-2 rounded-md transition-colors"
                       style="background:var(--move-purple);color:#fff;">
                        <i class="fas fa-plus mr-2" style="color:#fff"></i>
                        Novo Comunicado
                        <div class="loading-spinner hidden ml-2" id="spinner-announcement"></div>
                    </a>
                    <a href="{% url 'communication:campaign_create' %}" 
                       class="inline-flex items-center px-4 py-2 rounded-md transition-colors"
                       style="background:var(--move-pink);color:#fff;">
                        <i class="fas fa-paper-plane mr-2" style="color:#fff"></i>
                        Nova Campanha
                        <div class="loading-spinner hidden ml-2" id="spinner-campaign"></div>
                    </a>
                </div>
            </div>
        </div>

        <!-- Estatísticas Principais -->
        <div class="grid-optimized grid-optimized-4">
            <div class="bg-white p-6 rounded-lg shadow-sm" style="border-left:4px solid var(--move-blue)">
                <div class="flex-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 rounded-lg flex items-center justify-center" style="background:var(--move-blue)">
                            <i class="fas fa-paper-plane text-white text-xl" aria-label="Campanhas Ativas" data-tooltip="Campanhas enviadas e em andamento"></i>
                        </div>
                    </div>
            <div class="bg-white p-6 rounded-lg shadow-sm" style="border-left:4px solid var(--move-green)">
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Campanhas Ativas</p>
                        <p class="text-2xl font-bold text-gray-900">12</p>
                        <p class="text-sm text-green-600">+3 esta semana</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-green-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-eye text-white text-xl" style="background:var(--move-green);border-radius:8px;padding:4px;" aria-label="Taxa de Abertura" data-tooltip="Porcentagem de destinatários que abriram a comunicação"></i>
            <div class="bg-white p-6 rounded-lg shadow-sm" style="border-left:4px solid var(--move-purple)">
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Taxa de Abertura</p>
                        <p class="text-2xl font-bold text-gray-900">76.5%</p>
                        <p class="text-sm text-green-600">+2.3% vs mês passado</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-mouse-pointer text-white text-xl" style="background:var(--move-purple);border-radius:8px;padding:4px;" aria-label="Taxa de Cliques" data-tooltip="Porcentagem de destinatários que clicaram em links"></i>
            <div class="bg-white p-6 rounded-lg shadow-sm" style="border-left:4px solid var(--move-orange)">
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Taxa de Cliques</p>
                        <p class="text-2xl font-bold text-gray-900">23.8%</p>
                        <p class="text-sm text-green-600">+1.2% vs mês passado</p>
                    </div>
                </div>
            </div>

            <div class="bg-white p-6 rounded-lg shadow-sm">
                <div class="flex-center">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-orange-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-users text-white text-xl" style="background:var(--move-orange);border-radius:8px;padding:4px;" aria-label="Alcance Total" data-tooltip="Total de pessoas impactadas"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <p class="text-sm font-medium text-gray-500">Alcance Total</p>
                        <p class="text-2xl font-bold text-gray-900">1,847</p>
                        <p class="text-sm text-green-600">+156 este mês</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Gráfico de Performance -->
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-lg font-semibold text-gray-900">Performance das Campanhas</h2>
                <div class="flex space-x-2">
                    <button class="px-3 py-1 text-sm rounded-md" style="background:var(--move-purple);color:#fff;">7 dias</button>
                    <button class="px-3 py-1 text-sm rounded-md" style="background:var(--move-blue);color:#fff;">30 dias</button>
                    <button class="px-3 py-1 text-sm rounded-md" style="background:var(--move-orange);color:#fff;">90 dias</button>
                </div>
            </div>
            <div class="h-64">
                <canvas id="performanceChart"></canvas>
            </div>
        </div>

        <!-- Campanhas Recentes e Comunicados -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Campanhas Recentes -->
            <div class="bg-white shadow-sm rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold" style="color:var(--move-purple)">
                        <i class="fas fa-rocket mr-2" style="color:var(--move-purple)"></i>
                        Campanhas Recentes
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h3 class="font-medium" style="color:var(--move-blue)">Campanha de Onboarding</h3>
                                <p class="text-sm" style="color:var(--move-purple)">Enviada há 2 horas • Email</p>
                                <div class="flex items-center space-x-4 mt-2">
                                    <span class="text-xs px-2 py-1 rounded" style="background:var(--move-green);color:#fff;">Entregue</span>
                                    <span class="text-xs" style="color:var(--move-orange)">156 destinatários</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium" style="color:var(--move-green)">82%</div>
                                <div class="text-xs" style="color:var(--move-purple)">abertura</div>
<script>
// Spinner feedback nos botões de ação
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('a[href*="announcement_create"], a[href*="campaign_create"]').forEach(function(btn) {
        btn.addEventListener('click', function(e) {
            var spinner = btn.querySelector('.loading-spinner');
            if (spinner) spinner.classList.remove('hidden');
        });
    });
    // Tooltips explicativos
    document.querySelectorAll('[data-tooltip]').forEach(function(el) {
        el.addEventListener('mouseenter', function() {
            let tip = document.createElement('div');
            tip.className = 'tooltip-box';
            tip.textContent = el.getAttribute('data-tooltip');
            document.body.appendChild(tip);
            const rect = el.getBoundingClientRect();
            tip.style.top = (rect.bottom + window.scrollY + 4) + 'px';
            tip.style.left = (rect.left + window.scrollX) + 'px';
            el._tooltip = tip;
        });
        el.addEventListener('mouseleave', function() {
            if (el._tooltip) {
                document.body.removeChild(el._tooltip);
                el._tooltip = null;
            }
        });
    });
});
</script>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-900">Newsletter Semanal</h3>
                                <p class="text-sm text-gray-500">Enviada ontem • Email</p>
                                <div class="flex items-center space-x-4 mt-2">
                                    <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Concluída</span>
                                    <span class="text-xs text-gray-500">425 destinatários</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-gray-900">76%</div>
                                <div class="text-xs text-gray-500">abertura</div>
                            </div>
                        </div>

                        <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                            <div class="flex-1">
                                <h3 class="font-medium text-gray-900">Lembrete de Treinamento</h3>
                                <p class="text-sm text-gray-500">Enviada há 3 dias • SMS</p>
                                <div class="flex items-center space-x-4 mt-2">
                                    <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Finalizada</span>
                                    <span class="text-xs text-gray-500">89 destinatários</span>
                                </div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm font-medium text-gray-900">94%</div>
                                <div class="text-xs text-gray-500">entrega</div>
                            </div>
                        </div>
                    </div>
                    <div class="section-spacing-sm">
                        <a href="{% url 'communication:campaign_list' %}" 
                           class="text-move-purple-600 hover:text-move-purple-700 text-sm font-medium">
                            Ver todas as campanhas →
                        </a>
                    </div>
                </div>
            </div>

            <!-- Comunicados Ativos -->
            <div class="bg-white shadow-sm rounded-lg">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h2 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-megaphone text-move-purple-600 mr-2"></i>
                        Comunicados Ativos
                    </h2>
                </div>
                <div class="p-6">
                    <div class="space-y-4">
                        <div class="border border-red-200 bg-red-50 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-exclamation-triangle text-red-600"></i>
                                    <span class="text-sm font-medium text-red-800">Urgente</span>
                                </div>
                                <span class="text-xs text-red-600">Fixado</span>
                            </div>
                            <h3 class="font-medium text-gray-900 mt-2">Atualização do Sistema</h3>
                            <p class="text-sm text-gray-600 mt-1">
                                Manutenção programada para o próximo sábado das 8h às 12h.
                            </p>
                            <div class="flex items-center justify-between mt-3">
                                <span class="text-xs text-gray-500">89% leram</span>
                                <div class="w-32 bg-gray-200 rounded-full h-2">
                                    <div class="bg-red-600 h-2 rounded-full" style="width: 89%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="border border-blue-200 bg-blue-50 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-info-circle text-blue-600"></i>
                                    <span class="text-sm font-medium text-blue-800">Informativo</span>
                                </div>
                            </div>
                            <h3 class="font-medium text-gray-900 mt-2">Novo Processo de Avaliação</h3>
                            <p class="text-sm text-gray-600 mt-1">
                                Confira as mudanças no processo de avaliação de desempenho.
                            </p>
                            <div class="flex items-center justify-between mt-3">
                                <span class="text-xs text-gray-500">65% leram</span>
                                <div class="w-32 bg-gray-200 rounded-full h-2">
                                    <div class="bg-blue-600 h-2 rounded-full" style="width: 65%"></div>
                                </div>
                            </div>
                        </div>

                        <div class="border border-green-200 bg-green-50 rounded-lg p-4">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center space-x-2">
                                    <i class="fas fa-calendar text-green-600"></i>
                                    <span class="text-sm font-medium text-green-800">Evento</span>
                                </div>
                            </div>
                            <h3 class="font-medium text-gray-900 mt-2">Confraternização de Fim de Ano</h3>
                            <p class="text-sm text-gray-600 mt-1">
                                Inscrições abertas para o evento de confraternização.
                            </p>
                            <div class="flex items-center justify-between mt-3">
                                <span class="text-xs text-gray-500">72% leram</span>
                                <div class="w-32 bg-gray-200 rounded-full h-2">
                                    <div class="bg-green-600 h-2 rounded-full" style="width: 72%"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="section-spacing-sm">
                        <a href="{% url 'communication:announcement_list' %}" 
                           class="text-move-purple-600 hover:text-move-purple-700 text-sm font-medium">
                            Ver todos os comunicados →
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Segmentos de Audiência -->
        <div class="bg-white shadow-sm rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-users text-move-purple-600 mr-2"></i>
                        Segmentos de Audiência
                    </h2>
                    <a href="{% url 'communication:segment_create' %}" 
                       class="text-move-purple-600 hover:text-move-purple-700 text-sm font-medium">
                        Criar Segmento
                    </a>
                </div>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-medium text-gray-900">Novos Funcionários</h3>
                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">Ativo</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">
                            Funcionários contratados nos últimos 30 dias
                        </p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-900">23 membros</span>
                            <span class="text-xs text-gray-500">Atualizado hoje</span>
                        </div>
                    </div>

                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-medium text-gray-900">Gestores</h3>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">Ativo</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">
                            Funcionários com cargo de gestão
                        </p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-900">14 membros</span>
                            <span class="text-xs text-gray-500">Atualizado hoje</span>
                        </div>
                    </div>

                    <div class="border border-gray-200 rounded-lg p-4">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-medium text-gray-900">Departamento TI</h3>
                            <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">Ativo</span>
                        </div>
                        <p class="text-sm text-gray-600 mb-3">
                            Todos os membros do departamento de TI
                        </p>
                        <div class="flex items-center justify-between">
                            <span class="text-sm font-medium text-gray-900">8 membros</span>
                            <span class="text-xs text-gray-500">Atualizado hoje</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Gráfico de Performance
        const ctx = document.getElementById('performanceChart').getContext('2d');
        const performanceChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'Sáb', 'Dom'],
                datasets: [{
                    label: 'Taxa de Abertura',
                    data: [65, 72, 68, 75, 80, 78, 82],
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4
                }, {
                    label: 'Taxa de Cliques',
                    data: [25, 28, 22, 30, 32, 28, 34],
                    borderColor: '#764ba2',
                    backgroundColor: 'rgba(118, 75, 162, 0.1)',
                    tension: 0.4
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        max: 100
                    }
                }
            }
        });

        // Atualização automática das métricas
        setInterval(function() {
            // Aqui você pode implementar AJAX para atualizar as métricas
            console.log('Atualizando métricas de comunicação...');
        }, 60000); // Atualiza a cada minuto
    </script>
{% endblock %}
