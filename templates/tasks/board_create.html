{% extends 'tasks/base.html' %}
{% load static %}

{% block title %}Criar Quadro - Move Marias{% endblock %}

{% block extra_css %}
<style>
    .form-section {
        transition: all 0.3s ease;
    }
    .form-section:focus-within {
        box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
    }
    .department-option {
        transition: all 0.2s ease;
    }
    .department-option:hover {
        background-color: #F3F4F6;
    }
    .member-tag {
        transition: all 0.2s ease;
    }
    .member-tag:hover {
        background-color: #EDE9FE;
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<!-- Add breadcrumb items here if needed -->
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
<!-- Header -->
    <div class="section-spacing-lg">
        <div class="flex items-center space-x-4 mb-4">
            <a href="{% url 'tasks:board_list' %}" 
               class="text-gray-400 hover:text-gray-600 transition-colors">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Criar Novo Quadro</h1>
                <p class="text-gray-600">Configure seu quadro Kanban para organizar tarefas e projetos</p>
            </div>
        </div>
    </div>

    <!-- Formulário -->
    <form method="post" class="space-y-8">
        {% csrf_token %}
        
        <!-- Informações Básicas -->
        <div class="form-section bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Informações Básicas</h3>
            
            <div class="grid-optimized grid-optimized-1">
                <!-- Nome do Quadro -->
                <div>
                    <label for="id_name" class="block text-sm font-medium text-gray-700 mb-2">
                        Nome do Quadro <span class="text-red-500">*</span>
                    </label>
                    <input type="text" 
                           name="name" 
                           id="id_name"
                           required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-move-purple-500 focus:border-move-purple-500"
                           placeholder="Ex: Projeto Website, Sprint 1, Desenvolvimento">
                    <p class="mt-1 text-sm text-gray-500">
                        Digite um nome descritivo para identificar facilmente este quadro
                    </p>
                </div>
                
                <!-- Descrição -->
                <div>
                    <label for="id_description" class="block text-sm font-medium text-gray-700 mb-2">
                        Descrição
                    </label>
                    <textarea name="description" 
                              id="id_description"
                              rows="3"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-move-purple-500 focus:border-move-purple-500"
                              placeholder="Descreva o objetivo e escopo deste quadro..."></textarea>
                    <p class="mt-1 text-sm text-gray-500">
                        Opcional: adicione mais contexto sobre este quadro
                    </p>
                </div>
            </div>
        </div>

        <!-- Organização -->
        <div class="form-section bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Organização</h3>
            
            <!-- Departamento -->
            <div>
                <label for="id_department" class="block text-sm font-medium text-gray-700 mb-2">
                    Departamento
                </label>
                <select name="department" 
                        id="id_department"
                        class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-move-purple-500 focus:border-move-purple-500">
                    <option value="">Selecione um departamento (opcional)</option>
                    <!-- Departamentos serão carregados via JavaScript ou pelo backend -->
                </select>
                <p class="mt-1 text-sm text-gray-500">
                    Associe este quadro a um departamento específico
                </p>
            </div>
        </div>

        <!-- Membros -->
        <div class="form-section bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Membros da Equipe</h3>
            
            <div class="section-spacing-sm">
                <label for="member-search" class="block text-sm font-medium text-gray-700 mb-2">
                    Adicionar Membros
                </label>
                <div class="relative">
                    <input type="text" 
                           id="member-search"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-move-purple-500 focus:border-move-purple-500"
                           placeholder="Digite o nome ou email para buscar usuários...">
                    <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
                        <i class="fas fa-search text-gray-400"></i>
                    </div>
                </div>
                <p class="mt-1 text-sm text-gray-500">
                    Você será automaticamente adicionado como proprietário do quadro
                </p>
            </div>
            
            <!-- Lista de membros selecionados -->
            <div id="selected-members" class="hidden">
                <h4 class="text-sm font-medium text-gray-700 mb-2">Membros Selecionados</h4>
                <div id="members-list" class="flex flex-wrap gap-2">
                    <!-- Membros selecionados aparecerão aqui -->
                </div>
            </div>
        </div>

        <!-- Configurações Iniciais -->
        <div class="form-section bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Configurações Iniciais</h3>
            
            <div class="space-y-4">
                <!-- Colunas padrão -->
                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">
                        Colunas Padrão
                    </label>
                    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
                        <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                            <input type="checkbox" 
                                   id="col-todo" 
                                   name="default_columns" 
                                   value="todo"
                                   checked
                                   class="h-4 w-4 text-move-purple-600 focus:ring-move-purple-500 border-gray-300 rounded">
                            <label for="col-todo" class="ml-2 text-sm text-gray-700">
                                A Fazer
                            </label>
                        </div>
                        <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                            <input type="checkbox" 
                                   id="col-progress" 
                                   name="default_columns" 
                                   value="in_progress"
                                   checked
                                   class="h-4 w-4 text-move-purple-600 focus:ring-move-purple-500 border-gray-300 rounded">
                            <label for="col-progress" class="ml-2 text-sm text-gray-700">
                                Em Andamento
                            </label>
                        </div>
                        <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                            <input type="checkbox" 
                                   id="col-review" 
                                   name="default_columns" 
                                   value="review"
                                   checked
                                   class="h-4 w-4 text-move-purple-600 focus:ring-move-purple-500 border-gray-300 rounded">
                            <label for="col-review" class="ml-2 text-sm text-gray-700">
                                Em Revisão
                            </label>
                        </div>
                        <div class="flex items-center p-3 border border-gray-200 rounded-lg">
                            <input type="checkbox" 
                                   id="col-done" 
                                   name="default_columns" 
                                   value="done"
                                   checked
                                   class="h-4 w-4 text-move-purple-600 focus:ring-move-purple-500 border-gray-300 rounded">
                            <label for="col-done" class="ml-2 text-sm text-gray-700">
                                Concluído
                            </label>
                        </div>
                    </div>
                    <p class="mt-2 text-sm text-gray-500">
                        Selecione as colunas que serão criadas automaticamente no seu quadro
                    </p>
                </div>
            </div>
        </div>

        <!-- Ações -->
        <div class="flex items-center justify-between pt-6 border-t border-gray-200">
            <a href="{% url 'tasks:board_list' %}" 
               class="bg-white border border-gray-300 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-50 transition-colors">
                <i class="fas fa-times mr-2"></i>
                Cancelar
            </a>
            
            <div class="flex space-x-3">
                <button type="button" 
                        id="save-draft"
                        class="bg-gray-100 text-gray-700 px-4 py-2 rounded-lg hover:bg-gray-200 transition-colors">
                    <i class="fas fa-save mr-2"></i>
                    Salvar Rascunho
                </button>
                <button type="submit" 
                        class="bg-move-purple-600 text-white px-6 py-2 rounded-lg hover:bg-move-purple-700 transition-colors">
                    <i class="fas fa-plus mr-2"></i>
                    Criar Quadro
                </button>
            </div>
        </div>
    </form>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Funcionalidade de busca de membros
    const memberSearch = document.getElementById('member-search');
    const selectedMembersDiv = document.getElementById('selected-members');
    const membersList = document.getElementById('members-list');
    let selectedMembers = [];
    
    // Simular busca de usuários (implementar com AJAX)
    memberSearch.addEventListener('input', function() {
        const query = this.value.trim();
        if (query.length >= 2) {
            // Implementar busca AJAX aqui
            console.log('Buscando usuários:', query);
        }
    });
    
    // Função para adicionar membro
    function addMember(member) {
        if (!selectedMembers.find(m => m.id === member.id)) {
            selectedMembers.push(member);
            updateMembersList();
            selectedMembersDiv.classList.remove('hidden');
        }
    }
    
    // Função para remover membro
    function removeMember(memberId) {
        selectedMembers = selectedMembers.filter(m => m.id !== memberId);
        updateMembersList();
        if (selectedMembers.length === 0) {
            selectedMembersDiv.classList.add('hidden');
        }
    }
    
    // Atualizar lista de membros
    function updateMembersList() {
        membersList.innerHTML = selectedMembers.map(member => `
            <div class="member-tag bg-move-purple-100 text-move-purple-800 px-3 py-1 rounded-full text-sm flex items-center">
                <span>${member.name}</span>
                <button type="button" 
                        onclick="removeMember(${member.id})"
                        class="ml-2 text-move-purple-600 hover:text-move-purple-800">
                    <i class="fas fa-times"></i>
                </button>
                <input type="hidden" name="members" value="${member.id}">
            </div>
        `).join('');
    }
    
    // Salvar rascunho
    document.getElementById('save-draft').addEventListener('click', function() {
        // Implementar funcionalidade de salvar rascunho
        alert('Funcionalidade de rascunho será implementada');
    });
});
</script>
</div>
{% endblock %}
