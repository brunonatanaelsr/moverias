{% extends 'base_optimized.html' %}
{% load static %}

{% block page_title %}Chat Interno{% endblock %}

{% block extra_css %}
    <link href="{% static 'css/chat.css' %}" rel="stylesheet">
    <style>
        .chat-container {
            height: calc(100vh - 200px);
            max-height: 700px;
        }
        .message-bubble {
            max-width: 70%;
            word-wrap: break-word;
        }
        .message-bubble.own {
            margin-left: auto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        .message-bubble.other {
            background: #f3f4f6;
            color: #1f2937;
        }
        .online-indicator {
            width: 8px;
            height: 8px;
            background: #10b981;
            border-radius: 50%;
            display: inline-block;
            margin-right: 4px;
        }
        .channel-list {
            max-height: 400px;
            overflow-y: auto;
        }
        .message-list {
            height: 400px;
            overflow-y: auto;
        }
        .typing-indicator {
            display: none;
            align-items: center;
            padding: 8px 16px;
            background: #f3f4f6;
            border-radius: 12px;
            margin: 8px 0;
        }
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        .typing-dot {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: #9ca3af;
            animation: typingDots 1.5s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.3s; }
        .typing-dot:nth-child(3) { animation-delay: 0.6s; }
        
        @keyframes typingDots {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
    </style>
{% endblock %}

{% block breadcrumb_items %}
<!-- Add breadcrumb items here if needed -->
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
<div class="flex h-full chat-container">
        <!-- Sidebar de Canais -->
        <div class="w-80 bg-white border-r border-gray-200 flex flex-col">
            <!-- Header -->
            <div class="p-4 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h2 class="text-lg font-semibold text-gray-900">
                        <i class="fas fa-comments text-move-purple-600 mr-2"></i>
                        Chat Interno
                    </h2>
                    <button id="create-channel-btn" class="p-2 text-gray-400 hover:text-move-purple-600 transition-colors">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </div>

            <!-- Busca -->
            <div class="p-4 border-b border-gray-200">
                <div class="relative">
                    <input type="text" id="channel-search" 
                           placeholder="Buscar canais..." 
                           class="w-full pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-move-purple-500 focus:border-transparent">
                    <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400"></i>
                </div>
            </div>

            <!-- Lista de Canais -->
            <div class="flex-1 overflow-y-auto channel-list">
                <div class="p-2">
                    <!-- Canais Públicos -->
                    <div class="section-spacing-sm">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider px-2 mb-2">
                            Canais Públicos
                        </h3>
                        <div class="space-y-1">
                            <div class="channel-item flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors active">
                                <i class="fas fa-hashtag text-gray-400 mr-2"></i>
                                <span class="flex-1 text-sm font-medium text-gray-900">geral</span>
                                <span class="bg-move-purple-500 text-white text-xs px-2 py-1 rounded-full">3</span>
                            </div>
                            <div class="channel-item flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                                <i class="fas fa-hashtag text-gray-400 mr-2"></i>
                                <span class="flex-1 text-sm font-medium text-gray-900">desenvolvimento</span>
                                <span class="bg-move-purple-500 text-white text-xs px-2 py-1 rounded-full">1</span>
                            </div>
                            <div class="channel-item flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                                <i class="fas fa-hashtag text-gray-400 mr-2"></i>
                                <span class="flex-1 text-sm font-medium text-gray-900">recursos-humanos</span>
                            </div>
                        </div>
                    </div>

                    <!-- Mensagens Diretas -->
                    <div class="section-spacing-sm">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider px-2 mb-2">
                            Mensagens Diretas
                        </h3>
                        <div class="space-y-1">
                            <div class="channel-item flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                                <div class="relative">
                                    <img src="https://ui-avatars.com/api/?name=Maria+Silva&background=667eea&color=fff" 
                                         alt="Maria Silva" class="w-6 h-6 rounded-full mr-2">
                                    <div class="online-indicator absolute -bottom-1 -right-1"></div>
                                </div>
                                <span class="flex-1 text-sm font-medium text-gray-900">Maria Silva</span>
                                <span class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">2</span>
                            </div>
                            <div class="channel-item flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                                <div class="relative">
                                    <img src="https://ui-avatars.com/api/?name=João+Santos&background=764ba2&color=fff" 
                                         alt="João Santos" class="w-6 h-6 rounded-full mr-2">
                                </div>
                                <span class="flex-1 text-sm font-medium text-gray-700">João Santos</span>
                            </div>
                        </div>
                    </div>

                    <!-- Threads -->
                    <div class="section-spacing-sm">
                        <h3 class="text-sm font-medium text-gray-500 uppercase tracking-wider px-2 mb-2">
                            Threads Ativas
                        </h3>
                        <div class="space-y-1">
                            <div class="channel-item flex items-center px-3 py-2 rounded-lg hover:bg-gray-100 cursor-pointer transition-colors">
                                <i class="fas fa-comments text-gray-400 mr-2"></i>
                                <span class="flex-1 text-sm font-medium text-gray-900">Discussão sobre projeto</span>
                                <span class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">5</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Área Principal do Chat -->
        <div class="flex-1 flex flex-col">
            <!-- Header do Canal -->
            <div class="p-4 border-b border-gray-200 bg-white">
                <div class="flex items-center justify-between">
                    <div class="flex-center">
                        <i class="fas fa-hashtag text-gray-400 mr-2"></i>
                        <h3 class="text-lg font-semibold text-gray-900">geral</h3>
                        <span class="ml-2 text-sm text-gray-500">23 membros</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button class="p-2 text-gray-400 hover:text-move-purple-600 transition-colors" title="Informações do Canal">
                            <i class="fas fa-info-circle"></i>
                        </button>
                        <button class="p-2 text-gray-400 hover:text-move-purple-600 transition-colors" title="Membros">
                            <i class="fas fa-users"></i>
                        </button>
                        <button class="p-2 text-gray-400 hover:text-move-purple-600 transition-colors" title="Configurações">
                            <i class="fas fa-cog"></i>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Lista de Mensagens -->
            <div class="flex-1 overflow-y-auto message-list p-4 bg-gray-50">
                <div class="space-y-4">
                    <!-- Mensagem do outro usuário -->
                    <div class="flex items-start space-x-3">
                        <img src="https://ui-avatars.com/api/?name=Maria+Silva&background=667eea&color=fff" 
                             alt="Maria Silva" class="w-8 h-8 rounded-full">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-medium text-gray-900">Maria Silva</span>
                                <span class="text-xs text-gray-500">10:30</span>
                            </div>
                            <div class="message-bubble other p-3 rounded-lg mt-1">
                                <p class="text-sm">Bom dia pessoal! Como estão os projetos desta semana?</p>
                            </div>
                        </div>
                    </div>

                    <!-- Mensagem própria -->
                    <div class="flex items-start space-x-3 justify-end">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2 justify-end">
                                <span class="text-xs text-gray-500">10:35</span>
                                <span class="text-sm font-medium text-gray-900">Você</span>
                            </div>
                            <div class="message-bubble own p-3 rounded-lg mt-1">
                                <p class="text-sm">Bom dia! Estou finalizando o relatório do projeto MoveMarias. Deve ficar pronto hoje.</p>
                            </div>
                        </div>
                        <img src="https://ui-avatars.com/api/?name=Bruno+Natanael&background=764ba2&color=fff" 
                             alt="Você" class="w-8 h-8 rounded-full">
                    </div>

                    <!-- Mensagem com reações -->
                    <div class="flex items-start space-x-3">
                        <img src="https://ui-avatars.com/api/?name=João+Santos&background=10b981&color=fff" 
                             alt="João Santos" class="w-8 h-8 rounded-full">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-medium text-gray-900">João Santos</span>
                                <span class="text-xs text-gray-500">10:40</span>
                            </div>
                            <div class="message-bubble other p-3 rounded-lg mt-1">
                                <p class="text-sm">Excelente! Estou ansioso para ver os resultados. 🚀</p>
                            </div>
                            <div class="flex items-center space-x-2 mt-2">
                                <div class="flex items-center space-x-1 bg-white border border-gray-200 rounded-full px-2 py-1">
                                    <span class="text-sm">👍</span>
                                    <span class="text-xs text-gray-600">3</span>
                                </div>
                                <div class="flex items-center space-x-1 bg-white border border-gray-200 rounded-full px-2 py-1">
                                    <span class="text-sm">🚀</span>
                                    <span class="text-xs text-gray-600">1</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Mensagem com thread -->
                    <div class="flex items-start space-x-3">
                        <img src="https://ui-avatars.com/api/?name=Ana+Costa&background=f59e0b&color=fff" 
                             alt="Ana Costa" class="w-8 h-8 rounded-full">
                        <div class="flex-1 min-w-0">
                            <div class="flex items-center space-x-2">
                                <span class="text-sm font-medium text-gray-900">Ana Costa</span>
                                <span class="text-xs text-gray-500">10:45</span>
                            </div>
                            <div class="message-bubble other p-3 rounded-lg mt-1">
                                <p class="text-sm">Precisamos discutir os novos processos de onboarding. Que tal uma reunião?</p>
                            </div>
                            <button class="flex items-center space-x-2 mt-2 text-sm text-move-purple-600 hover:text-move-purple-700">
                                <i class="fas fa-comments"></i>
                                <span>3 respostas</span>
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Indicador de digitação -->
                <div class="typing-indicator" id="typing-indicator">
                    <img src="https://ui-avatars.com/api/?name=Maria+Silva&background=667eea&color=fff" 
                         alt="Maria Silva" class="w-6 h-6 rounded-full mr-2">
                    <span class="text-sm text-gray-500 mr-2">Maria Silva está digitando</span>
                    <div class="typing-dots">
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                        <div class="typing-dot"></div>
                    </div>
                </div>
            </div>

            <!-- Caixa de Entrada -->
            <div class="p-4 border-t border-gray-200 bg-white">
                <div class="flex items-center space-x-2">
                    <button class="p-2 text-gray-400 hover:text-move-purple-600 transition-colors" title="Anexar Arquivo">
                        <i class="fas fa-paperclip"></i>
                    </button>
                    <button class="p-2 text-gray-400 hover:text-move-purple-600 transition-colors" title="Emoji">
                        <i class="fas fa-smile"></i>
                    </button>
                    <div class="flex-1 relative">
                        <input type="text" id="message-input" 
                               placeholder="Digite sua mensagem..." 
                               class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-move-purple-500 focus:border-transparent">
                    </div>
                    <button id="send-button" class="px-4 py-2 bg-move-purple-600 text-white rounded-lg hover:bg-move-purple-700 transition-colors">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Sidebar de Informações (oculta por padrão) -->
        <div class="w-80 bg-white border-l border-gray-200 hidden" id="info-sidebar">
            <div class="p-4 border-b border-gray-200">
                <h3 class="text-lg font-semibold text-gray-900">Informações do Canal</h3>
            </div>
            <div class="p-4 space-y-4">
                <div>
                    <h4 class="text-sm font-medium text-gray-900 mb-2">Membros Online</h4>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2">
                            <div class="online-indicator"></div>
                            <span class="text-sm text-gray-700">Maria Silva</span>
                        </div>
                        <div class="flex items-center space-x-2">
                            <div class="online-indicator"></div>
                            <span class="text-sm text-gray-700">João Santos</span>
                        </div>
                    </div>
                </div>
                <div>
                    <h4 class="text-sm font-medium text-gray-900 mb-2">Arquivos Recentes</h4>
                    <div class="space-y-2">
                        <div class="flex items-center space-x-2 p-2 bg-gray-50 rounded">
                            <i class="fas fa-file-pdf text-red-500"></i>
                            <span class="text-sm text-gray-700">relatorio.pdf</span>
                        </div>
                        <div class="flex items-center space-x-2 p-2 bg-gray-50 rounded">
                            <i class="fas fa-file-image text-blue-500"></i>
                            <span class="text-sm text-gray-700">screenshot.png</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
    <script>
        // Funcionalidade do chat
        document.addEventListener('DOMContentLoaded', function() {
            const messageInput = document.getElementById('message-input');
            const sendButton = document.getElementById('send-button');
            const messagesList = document.querySelector('.message-list');
            
            // Enviar mensagem
            function sendMessage() {
                const message = messageInput.value.trim();
                if (message) {
                    // Aqui você implementaria o envio via WebSocket
                    console.log('Enviando mensagem:', message);
                    messageInput.value = '';
                    
                    // Simular adição de mensagem (em produção seria via WebSocket)
                    // addMessageToChat(message, 'own');
                }
            }
            
            // Eventos
            sendButton.addEventListener('click', sendMessage);
            messageInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    sendMessage();
                }
            });
            
            // Scroll automático para a última mensagem
            messagesList.scrollTop = messagesList.scrollHeight;
            
            // Alternar sidebar de informações
            document.querySelector('[title="Informações do Canal"]').addEventListener('click', function() {
                document.getElementById('info-sidebar').classList.toggle('hidden');
            });
            
            // Busca de canais
            document.getElementById('channel-search').addEventListener('input', function(e) {
                const search = e.target.value.toLowerCase();
                const channels = document.querySelectorAll('.channel-item');
                
                channels.forEach(channel => {
                    const text = channel.textContent.toLowerCase();
                    if (text.includes(search)) {
                        channel.style.display = 'flex';
                    } else {
                        channel.style.display = 'none';
                    }
                });
            });
            
            // Alternar canal ativo
            document.querySelectorAll('.channel-item').forEach(item => {
                item.addEventListener('click', function() {
                    document.querySelectorAll('.channel-item').forEach(i => i.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Aqui você carregaria as mensagens do canal
                    console.log('Mudando para canal:', this.textContent.trim());
                });
            });
            
            // Simular indicador de digitação
            let typingTimer;
            messageInput.addEventListener('input', function() {
                clearTimeout(typingTimer);
                
                // Mostrar indicador (em produção seria via WebSocket)
                // showTypingIndicator();
                
                typingTimer = setTimeout(() => {
                    // Ocultar indicador
                    // hideTypingIndicator();
                }, 1000);
            });
        });
    </script>
{% endblock %}
