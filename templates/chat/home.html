{% extends 'base_optimized.html' %}
{% load static %}

{% block title %}Chat Interno - MoveMarias{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard specific animations */
    .dashboard-fade-in {
        animation: fadeIn 0.4s ease-out;
    }
    
    .dashboard-slide-up {
        animation: slideUp 0.5s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from { 
            opacity: 0;
            transform: translateY(15px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Hover effects */
    .dashboard-card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
    }
</style>
{% endblock %}

{% block extra_head %}
<style>
    .chat-container {
        height: calc(100vh - 140px);
        min-height: 500px;
    }
    .room-card {
        transition: all 0.2s ease;
        cursor: pointer;
    }
    .room-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }
    .unread-badge {
        animation: pulse 2s infinite;
    }
    @keyframes pulse {
        0% { transform: scale(1); }
        50% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }
    .online-indicator {
        position: absolute;
        bottom: 2px;
        right: 2px;
        width: 12px;
        height: 12px;
        background-color: #10B981;
        border: 2px solid white;
        border-radius: 50%;
    }
    .activity-item {
        border-left: 3px solid #E5E7EB;
        padding-left: 1rem;
    }
    .activity-item.recent {
        border-left-color: #8B5CF6;
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<!-- Add breadcrumb items here if needed -->
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
    <!-- Welcome Header -->
    <div class="dashboard-header-optimized dashboard-fade-in">
        <div class="dashboard-header-content-optimized">
            <div class="dashboard-header-icon">游눫</div>
            <div class="dashboard-header-text">
                <h1>Chat Interno</h1>
                <p>Comunique-se com sua equipe em tempo real</p>
            </div>
        </div>
        <div class="hidden lg:block">
            <a href="{% url 'chat:room_create' %}" 
               class="btn-primary dashboard-card-hover">
                <i class="fas fa-plus mr-2"></i> Nova Sala
            </a>
        </div>
    </div>
        
        <div class="flex items-center space-x-4 mt-4 sm:mt-0">
            <div class="flex items-center space-x-2 text-sm text-gray-600 dark:text-gray-400">
                <div class="h-2 w-2 bg-green-400 rounded-full animate-pulse"></div>
                <span>{{ online_users|length }} usu치rios online</span>
            </div>
            <a href="{% url 'chat:room_create' %}" 
               class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-move-purple-600 to-move-pink-600 text-white font-semibold rounded-lg hover:from-move-purple-700 hover:to-move-pink-700 transition-all duration-200 shadow-lg hover:shadow-xl transform hover:scale-105">
                <i class="fas fa-plus mr-2"></i>
                Nova Sala
            </a>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Salas de Chat -->
        <div class="lg:col-span-2">
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white">
                        <i class="fas fa-comments text-blue-500 mr-2"></i>
                        Salas de Chat
                    </h2>
                    <div class="flex items-center space-x-2">
                        <button class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-search"></i>
                        </button>
                        <button class="p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 transition-colors rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700">
                            <i class="fas fa-filter"></i>
                        </button>
                    </div>
                </div>
                
                <div class="space-y-4">
                    {% for room in user_rooms %}
                        <div class="group relative p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg border border-gray-200 dark:border-gray-600 hover:border-blue-300 dark:hover:border-blue-600 transition-all duration-200 hover:shadow-md cursor-pointer">
                            <a href="{% url 'chat:room_detail' room.id %}" class="absolute inset-0 z-10"></a>
                                <!-- Welcome Header -->
    <div class="dashboard-header-optimized dashboard-fade-in">
        <div class="dashboard-header-content-optimized">
            <div class="dashboard-header-icon">游눫</div>
            <div class="dashboard-header-text">
                <h1>Chat</h1>
                <p>Comunica칞칚o instant칙nea entre colaboradores</p>
            </div>
        </div>
        <div class="hidden lg:block text-right">
            <div class="text-sm opacity-90">{{ "now"|date:"l, j \d\e F \d\e Y" }}</div>
            <div class="text-xl font-bold">{{ "now"|date:"H:i" }}</div>
        </div>
    </div>
                                </div>
                                <div class="flex flex-col items-end">
                                    {% if room.unread_count > 0 %}
                                        <span class="inline-flex items-center justify-center w-6 h-6 bg-red-500 text-white text-xs font-medium rounded-full animate-pulse">
                                            {{ room.unread_count }}
                                        </span>
                                    {% endif %}
                                    <span class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                                        {{ room.last_message_time|timesince }} atr치s
                                    </span>
                                </div>
                            </div>
                        </div>
                    {% empty %}
                        <div class="text-center py-12">
                            <i class="fas fa-comments text-gray-400 dark:text-gray-500 text-5xl mb-4"></i>
                            <h3 class="text-lg font-medium text-gray-900 dark:text-white mb-2">Nenhuma sala de chat</h3>
                            <p class="text-gray-500 dark:text-gray-400 mb-6">Crie sua primeira sala para come칞ar a conversar</p>
                            <a href="{% url 'chat:room_create' %}" 
                               class="inline-flex items-center px-4 py-2 bg-gradient-to-r from-blue-600 to-purple-600 text-white font-semibold rounded-lg hover:from-blue-700 hover:to-purple-700 transition-all duration-200">
                                <i class="fas fa-plus mr-2"></i>
                                Criar Primeira Sala
                            </a>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Usu치rios Online -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-user-friends text-green-500 mr-2"></i>
                    Usu치rios Online
                </h3>
                <div class="space-y-3">
                    {% for user in online_users %}
                        <div class="flex items-center space-x-3">
                            <div class="relative">
                                <div class="w-8 h-8 bg-gradient-to-br from-green-400 to-blue-500 rounded-full flex items-center justify-center">
                                    <span class="text-white text-sm font-medium">
                                        {{ user.first_name|first|default:user.username|first }}
                                    </span>
                                </div>
                                <div class="absolute -bottom-0.5 -right-0.5 w-3 h-3 bg-green-400 border-2 border-white dark:border-gray-800 rounded-full"></div>
                            </div>
                            <div>
                                <p class="text-sm font-medium text-gray-900 dark:text-white">
                                    {{ user.get_full_name|default:user.username }}
                                </p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">Online</p>
                            </div>
                        </div>
                    {% empty %}
                        <div class="text-center py-4">
                            <i class="fas fa-user-slash text-gray-400 dark:text-gray-500 text-2xl mb-2"></i>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Nenhum usu치rio online</p>
                        </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Atividade Recente -->
            <div class="bg-white dark:bg-gray-800 rounded-xl p-6 shadow-lg border border-gray-200 dark:border-gray-700">
                <h3 class="text-lg font-semibold text-gray-900 dark:text-white mb-4">
                    <i class="fas fa-clock text-purple-500 mr-2"></i>
                    Atividade Recente
                </h3>
                <div class="space-y-3">
                    {% for activity in recent_activities %}
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-purple-100 dark:bg-purple-800 rounded-lg flex items-center justify-center">
                                <i class="fas fa-comment text-purple-600 dark:text-purple-400 text-xs"></i>
                            </div>
                            <div class="flex-1 min-w-0">
                                <p class="text-sm font-medium text-gray-900 dark:text-white">
                                    {{ activity.user.get_full_name|default:activity.user.username }}
                                </p>
                                <p class="text-xs text-gray-500 dark:text-gray-400">
                                    {{ activity.message|truncatewords:5 }}
                                </p>
                                <p class="text-xs text-gray-400 dark:text-gray-500">
                                    {{ activity.timestamp|timesince }} atr치s
                                </p>
                            </div>
                        </div>
                    {% empty %}
                        <div class="text-center py-4">
                            <i class="fas fa-clock text-gray-400 dark:text-gray-500 text-2xl mb-2"></i>
                            <p class="text-sm text-gray-500 dark:text-gray-400">Nenhuma atividade recente</p>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>

                        </button>
                    </div>
                </div>

                {% if user_rooms %}
                <div class="space-y-4">
                    {% for room in user_rooms %}
                    <div class="room-card bg-gray-50 rounded-lg p-4 hover:bg-gray-100 transition-colors"
                         onclick="window.location.href='{% url 'chat:room_detail' room.id %}'">
                            <!-- Welcome Header -->
    <div class="dashboard-header-optimized dashboard-fade-in">
        <div class="dashboard-header-content-optimized">
            <div class="dashboard-header-icon">游눫</div>
            <div class="dashboard-header-text">
                <h1>Chat</h1>
                <p>Comunica칞칚o instant칙nea entre colaboradores</p>
            </div>
        </div>
        <div class="hidden lg:block text-right">
            <div class="text-sm opacity-90">{{ "now"|date:"l, j \d\e F \d\e Y" }}</div>
            <div class="text-xl font-bold">{{ "now"|date:"H:i" }}</div>
        </div>
    </div>
                                <div>
                                    <h3 class="font-medium text-gray-900">{{ room.name }}</h3>
                                    <p class="text-sm text-gray-600">{{ room.description|truncatewords:10 }}</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <div class="flex items-center text-sm text-gray-500">
                                    <i class="fas fa-users mr-1"></i>
                                    {{ room.members.count }}
                                </div>
                                <div class="text-sm text-gray-500">
                                    {% if room.last_message_time %}
                                    {{ room.last_message_time|timesince }} atr치s
                                    {% else %}
                                    Sem mensagens
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-12">
                    <i class="fas fa-comments text-4xl text-gray-400 mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 mb-2">Nenhuma sala encontrada</h3>
                    <p class="text-gray-600 mb-6">Crie uma nova sala para come칞ar a conversar com sua equipe.</p>
                    <a href="{% url 'chat:room_create' %}" 
                       class="bg-move-purple-600 text-white px-6 py-3 rounded-lg hover:bg-move-purple-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>
                        Criar primeira sala
                    </a>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Painel Lateral -->
        <div class="space-y-6">
            <!-- Usu치rios Online -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Usu치rios Online</h3>
                {% if online_users %}
                <div class="space-y-3">
                    {% for user in online_users %}
                    <div class="flex items-center space-x-3">
                        <div class="relative">
                            <div class="h-8 w-8 bg-gray-300 rounded-full flex items-center justify-center">
                                <span class="text-sm font-medium text-gray-700">
                                    {{ user.get_full_name|slice:":1"|upper }}
                                </span>
                            </div>
                            <div class="absolute -bottom-1 -right-1 h-3 w-3 bg-green-400 rounded-full border-2 border-white"></div>
                        </div>
                        <div>
                            <p class="text-sm font-medium text-gray-900">{{ user.get_full_name }}</p>
                            <p class="text-xs text-gray-500">{{ user.role|title }}</p>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="text-sm text-gray-500">Nenhum usu치rio online no momento.</p>
                {% endif %}
            </div>

            <!-- Atividade Recente -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Atividade Recente</h3>
                <p class="text-sm text-gray-500">Funcionalidade em desenvolvimento.</p>
            </div>

            <!-- Estat칤sticas -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Estat칤sticas</h3>
                <div class="space-y-3">
                    <div class="flex-between">
                        <span class="text-sm text-gray-600">Minhas salas</span>
                        <span class="text-sm font-medium text-gray-900">{{ user_rooms|length }}</span>
                    </div>
                    <div class="flex-between">
                        <span class="text-sm text-gray-600">Notifica칞칫es n칚o lidas</span>
                        <span class="text-sm font-medium text-gray-900">{{ unread_notifications }}</span>
                    </div>
                    <div class="flex-between">
                        <span class="text-sm text-gray-600">Usu치rios online</span>
                        <span class="text-sm font-medium text-gray-900">{{ online_users|length }}</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Atualizar status online dos usu치rios
    function updateOnlineStatus() {
        // Implementar WebSocket para status em tempo real
        console.log('Atualizando status online...');
    }

    // Atualizar a cada 30 segundos
    setInterval(updateOnlineStatus, 30000);

    // Marcar como lida quando clicar em uma sala
    document.querySelectorAll('.room-card').forEach(card => {
        card.addEventListener('click', function() {
            const unreadBadge = this.querySelector('.unread-badge');
            if (unreadBadge) {
                unreadBadge.style.opacity = '0.5';
            }
        });
    });
</script>
{% endblock %}
