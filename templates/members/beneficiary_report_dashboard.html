{% extends 'base_optimized.html' %}
{% load static %}
{% block title %}Relat칩rios de Benefici치rias{% endblock %}

{% block extra_css %}
<style>
    /* Dashboard specific animations */
    .dashboard-fade-in {
        animation: fadeIn 0.4s ease-out;
    }
    
    .dashboard-slide-up {
        animation: slideUp 0.5s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from { 
            opacity: 0;
            transform: translateY(15px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Hover effects */
    .dashboard-card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<!-- Add breadcrumb items here if needed -->
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
    <!-- Welcome Header -->
    <div class="dashboard-header-optimized dashboard-fade-in">
        <div class="dashboard-header-content-optimized">
            <div class="dashboard-header-icon">游논</div>
            <div class="dashboard-header-text">
                <h1>Benefici치rias</h1>
                <p>Gerencie benefici치rias e acompanhe desenvolvimento</p>
            </div>
        </div>
        <div class="hidden lg:block text-right">
            <div class="text-sm opacity-90">{{ "now"|date:"l, j \d\e F \d\e Y" }}</div>
            <div class="text-xl font-bold">{{ "now"|date:"H:i" }}</div>
        </div>
    </div>

<div class="mb-8 flex items-center justify-between">
        <h1 class="text-3xl font-bold text-gray-900">Relat칩rios de Benefici치rias</h1>
    </div>
    <form method="get" class="bg-white shadow rounded-lg p-6 mb-8 grid grid-cols-1 md:grid-cols-5 gap-4">
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Status</label>
            <select name="status" class="form-select w-full">
                <option value="">Todos</option>
                {% for value, label in status_choices %}
                    <option value="{{ value }}" {% if request.GET.status == value %}selected{% endif %}>{{ label }}</option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Bairro</label>
            <input type="text" name="neighbourhood" value="{{ request.GET.neighbourhood }}" class="form-input w-full" placeholder="Bairro">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Idade M칤nima</label>
            <input type="number" name="min_age" value="{{ request.GET.min_age }}" class="form-input w-full" min="0">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Idade M치xima</label>
            <input type="number" name="max_age" value="{{ request.GET.max_age }}" class="form-input w-full" min="0">
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">Vulnerabilidade</label>
            <select name="vulnerability" class="form-select w-full">
                <option value="">Todas</option>
                <option value="sim" {% if request.GET.vulnerability == 'sim' %}selected{% endif %}>Sim</option>
            </select>
        </div>
        <div>
            <label class="block text-sm font-medium text-gray-700 mb-1">N췈 de Filhos</label>
            <input type="number" name="num_children" value="{{ request.GET.num_children }}" class="form-input w-full" min="0">
        </div>
        <div class="md:col-span-5 flex items-end">
            <button type="submit" class="inline-flex items-center px-4 py-2 bg-purple-600 border border-transparent rounded-md font-semibold text-xs text-white uppercase tracking-widest hover:bg-purple-700">Filtrar</button>
        </div>
    </form>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <h3 class="text-lg font-semibold mb-2">Total de Benefici치rias</h3>
            <p class="text-3xl font-bold">{{ total }}</p>
            <p class="text-sm text-gray-500">Ativas: {{ total_active }} | Inativas: {{ total_inactive }}</p>
        </div>
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <h3 class="text-lg font-semibold mb-2">Idade M칠dia</h3>
            <p class="text-3xl font-bold">{{ avg_age }}</p>
            <p class="text-sm text-gray-500">M칤n: {{ min_age|default:'-' }} | M치x: {{ max_age|default:'-' }}</p>
        </div>
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <h3 class="text-lg font-semibold mb-2">Distribui칞칚o por Bairro</h3>
            <ul class="text-sm text-gray-700 space-y-1">
                {% for n in neighbourhoods %}
                    <li>{{ n.neighbourhood|default:'-' }}: {{ n.count }}</li>
                {% endfor %}
            </ul>
        </div>
    </div>
    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <h3 class="text-lg font-semibold mb-2">Distribui칞칚o por N췈 de Filhos</h3>
            <ul class="text-sm text-gray-700 space-y-1">
                {% for c in children_dist %}
                    <li>{{ c.number_of_children|default:'-' }} filho(s): {{ c.count }}</li>
                {% endfor %}
            </ul>
        </div>
        <div class="card-optimized card-padding-md" dashboard-card-hover dashboard-slide-up>
            <h3 class="text-lg font-semibold mb-2">Status</h3>
            <ul class="text-sm text-gray-700 space-y-1">
                <li>Ativas: {{ total_active }}</li>
                <li>Inativas: {{ total_inactive }}</li>
            </ul>
        </div>
    </div>
    <div class="bg-white shadow rounded-lg p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4">Lista de Benefici치rias ({{ total }})</h3>
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-300">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nome</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Idade</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Bairro</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N췈 Filhos</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Relat칩rio</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for b in beneficiaries %}
                    <tr>
                        <td class="px-6 py-4 whitespace-nowrap">{{ b.full_name }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">{{ b.age|default:'-' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">{{ b.neighbourhood|default:'-' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">{{ b.number_of_children|default:'-' }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">{{ b.get_status_display }}</td>
                        <td class="px-6 py-4 whitespace-nowrap">
                            <a href="{% url 'members:beneficiary-report' b.pk %}" class="text-purple-600 hover:text-purple-900 font-medium">Ver Relat칩rio</a>
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="6" class="px-6 py-12 text-center text-gray-500">Nenhuma benefici치ria encontrada.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <!-- Gr치ficos (exemplo com Chart.js) -->
    <div class="bg-white shadow rounded-lg p-6 mb-8">
        <h3 class="text-lg font-semibold mb-4">Gr치ficos</h3>
        <canvas id="chart-age" height="80"></canvas>
        <canvas id="chart-children" height="80" class="section-spacing-lg"></canvas>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Exemplo de gr치fico de idades
const ctxAge = document.getElementById('chart-age').getContext('2d');
const ageData = {
    labels: [{% for b in beneficiaries %}'{{ b.full_name }}',{% endfor %}],
    datasets: [{
        label: 'Idade',
        data: [{% for b in beneficiaries %}{{ b.age|default:0 }},{% endfor %}],
        backgroundColor: 'rgba(139, 92, 246, 0.5)',
        borderColor: 'rgba(139, 92, 246, 1)',
        borderWidth: 1
    }]
};
new Chart(ctxAge, {
    type: 'bar',
    data: ageData,
    options: {responsive: true, plugins: {legend: {display: false}}}
});
// Exemplo de gr치fico de filhos
const ctxChildren = document.getElementById('chart-children').getContext('2d');
const childrenData = {
    labels: [{% for c in children_dist %}'{{ c.number_of_children|default:"-" }}',{% endfor %}],
    datasets: [{
        label: 'N췈 de Filhos',
        data: [{% for c in children_dist %}{{ c.count }},{% endfor %}],
        backgroundColor: 'rgba(16, 185, 129, 0.5)',
        borderColor: 'rgba(16, 185, 129, 1)',
        borderWidth: 1
    }]
};
new Chart(ctxChildren, {
    type: 'bar',
    data: childrenData,
    options: {responsive: true, plugins: {legend: {display: false}}}
});
</script>
</div>
{% endblock %}
