{% extends "base_optimized.html" %}
{% load static %}

{% block title %}Avaliação de {{ evaluation.employee.first_name }} - Move Marias{% endblock %}

{% block extra_css %}
<style>
.evaluation-detail-container {
    max-width: 6xl;
}

.detail-header {
    background: linear-gradient(135deg, #ec4899 0%, #8b5cf6 100%);
    color: white;
    border-radius: 24px;
    padding: 40px;
    margin-bottom: 32px;
    position: relative;
    overflow: hidden;
}

.detail-header::before {
    content: '';
    position: absolute;
    top: -50px;
    right: -50px;
    width: 150px;
    height: 150px;
    background: rgba(255, 255, 255, 0.1);
    border-radius: 50%;
    animation: rotate 20s linear infinite;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.header-main {
    position: relative;
    z-index: 1;
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 24px;
}

.employee-profile {
    display: flex;
    align-items: center;
    gap: 20px;
}

.employee-avatar {
    width: 80px;
    height: 80px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.2);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    font-weight: 800;
    border: 3px solid rgba(255, 255, 255, 0.3);
}

.employee-info h1 {
    font-size: 32px;
    font-weight: 800;
    margin-bottom: 4px;
}

.employee-position {
    font-size: 16px;
    opacity: 0.9;
    margin-bottom: 8px;
}

.employee-department {
    font-size: 14px;
    opacity: 0.8;
    display: flex;
    align-items: center;
    gap: 4px;
}

.status-badge {
    padding: 8px 16px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    display: flex;
    align-items: center;
    gap: 6px;
}

.status-completed {
    background: rgba(16, 185, 129, 0.2);
    color: #065f46;
    border: 2px solid rgba(16, 185, 129, 0.3);
}

.status-pending {
    background: rgba(245, 158, 11, 0.2);
    color: #92400e;
    border: 2px solid rgba(245, 158, 11, 0.3);
}

.status-in-progress {
    background: rgba(59, 130, 246, 0.2);
    color: #1e40af;
    border: 2px solid rgba(59, 130, 246, 0.3);
}

.evaluation-meta {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 20px;
    margin-top: 24px;
}

.meta-item {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: 16px;
    padding: 16px;
    text-align: center;
    border: 1px solid rgba(255, 255, 255, 0.2);
}

.meta-value {
    font-size: 20px;
    font-weight: 800;
    margin-bottom: 4px;
}

.meta-label {
    font-size: 11px;
    opacity: 0.8;
    text-transform: uppercase;
    font-weight: 600;
}

.action-buttons {
    display: flex;
    gap: 12px;
    align-items: flex-start;
}

.btn-action {
    padding: 10px 20px;
    border-radius: 12px;
    font-weight: 600;
    text-decoration: none;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 6px;
    border: none;
    cursor: pointer;
    font-size: 14px;
}

.btn-primary {
    background: white;
    color: #ec4899;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    color: #ec4899;
}

.btn-secondary {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.btn-secondary:hover {
    background: rgba(255, 255, 255, 0.3);
    color: white;
}

.content-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 32px;
}

.main-content {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.content-card {
    background: white;
    border-radius: 20px;
    padding: 32px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(236, 72, 153, 0.1);
}

.card-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 2px solid #f3f4f6;
}

.card-title {
    font-size: 20px;
    font-weight: 700;
    color: #1f2937;
    display: flex;
    align-items: center;
    gap: 8px;
}

.card-action {
    font-size: 12px;
    color: #ec4899;
    text-decoration: none;
    font-weight: 600;
    padding: 6px 12px;
    border-radius: 6px;
    border: 1px solid #ec4899;
    transition: all 0.2s ease;
}

.card-action:hover {
    background: #ec4899;
    color: white;
}

.competencies-grid {
    display: grid;
    gap: 16px;
}

.competency-item {
    background: #f9fafb;
    border-radius: 12px;
    padding: 20px;
    border-left: 4px solid #ec4899;
    transition: all 0.3s ease;
}

.competency-item:hover {
    background: #f3f4f6;
    transform: translateX(4px);
}

.competency-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 12px;
}

.competency-name {
    font-size: 16px;
    font-weight: 600;
    color: #1f2937;
}

.competency-rating {
    display: flex;
    align-items: center;
    gap: 8px;
}

.rating-stars {
    display: flex;
    gap: 2px;
}

.star {
    width: 16px;
    height: 16px;
    color: #fbbf24;
}

.star.filled {
    fill: currentColor;
}

.rating-value {
    font-size: 14px;
    font-weight: 700;
    color: #ec4899;
    background: white;
    padding: 4px 8px;
    border-radius: 6px;
}

.competency-comment {
    font-size: 14px;
    color: #6b7280;
    line-height: 1.5;
    margin-top: 8px;
    font-style: italic;
}

.goals-list {
    display: flex;
    flex-direction: column;
    gap: 20px;
}

.goal-item {
    background: #f0f9ff;
    border-radius: 16px;
    padding: 24px;
    border: 2px solid #e0f2fe;
    transition: all 0.3s ease;
}

.goal-item:hover {
    border-color: #0ea5e9;
    box-shadow: 0 4px 15px rgba(14, 165, 233, 0.1);
}

.goal-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    margin-bottom: 12px;
}

.goal-title {
    font-size: 16px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 4px;
}

.goal-status {
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
}

.goal-completed {
    background: #d1fae5;
    color: #065f46;
}

.goal-in-progress {
    background: #fef3c7;
    color: #92400e;
}

.goal-not-started {
    background: #fee2e2;
    color: #991b1b;
}

.goal-description {
    font-size: 14px;
    color: #6b7280;
    line-height: 1.5;
    margin-bottom: 16px;
}

.goal-progress {
    margin-top: 16px;
}

.progress-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
    font-size: 12px;
    font-weight: 600;
    color: #374151;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background: #e5e7eb;
    border-radius: 4px;
    overflow: hidden;
}

.progress-fill {
    height: 100%;
    background: linear-gradient(90deg, #0ea5e9, #06b6d4);
    border-radius: 4px;
    transition: width 0.5s ease;
}

.feedback-sections {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.feedback-section {
    background: #fafafa;
    border-radius: 16px;
    padding: 24px;
    border-left: 4px solid transparent;
}

.feedback-section.strengths {
    border-left-color: #10b981;
    background: #f0fdf4;
}

.feedback-section.improvements {
    border-left-color: #f59e0b;
    background: #fffbeb;
}

.feedback-section.goals {
    border-left-color: #3b82f6;
    background: #f0f9ff;
}

.feedback-title {
    font-size: 16px;
    font-weight: 700;
    color: #1f2937;
    margin-bottom: 12px;
    display: flex;
    align-items: center;
    gap: 8px;
}

.feedback-content {
    font-size: 14px;
    color: #4b5563;
    line-height: 1.6;
    white-space: pre-wrap;
}

.sidebar {
    display: flex;
    flex-direction: column;
    gap: 24px;
}

.sidebar-card {
    background: white;
    border-radius: 16px;
    padding: 24px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    border: 1px solid rgba(236, 72, 153, 0.1);
}

.timeline {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.timeline-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    padding: 16px;
    background: #f9fafb;
    border-radius: 12px;
}

.timeline-icon {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.timeline-icon.created {
    background: #dbeafe;
    color: #1e40af;
}

.timeline-icon.updated {
    background: #fef3c7;
    color: #92400e;
}

.timeline-icon.completed {
    background: #d1fae5;
    color: #065f46;
}

.timeline-content {
    flex-grow: 1;
}

.timeline-title {
    font-size: 14px;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 2px;
}

.timeline-desc {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 4px;
}

.timeline-date {
    font-size: 11px;
    color: #9ca3af;
}

.stats-overview {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
}

.stat-card {
    background: #f9fafb;
    border-radius: 12px;
    padding: 16px;
    text-align: center;
}

.stat-value {
    font-size: 24px;
    font-weight: 800;
    color: #ec4899;
    margin-bottom: 4px;
}

.stat-label {
    font-size: 11px;
    color: #6b7280;
    text-transform: uppercase;
    font-weight: 600;
}

.evaluator-info {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 16px;
    background: #f0fdf4;
    border-radius: 12px;
    border: 1px solid #bbf7d0;
}

.evaluator-avatar {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: #10b981;
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
}

.evaluator-details {
    flex-grow: 1;
}

.evaluator-name {
    font-size: 14px;
    font-weight: 600;
    color: #1f2937;
    margin-bottom: 2px;
}

.evaluator-role {
    font-size: 12px;
    color: #6b7280;
}

.print-section {
    margin-top: 32px;
    padding: 24px;
    background: #f9fafb;
    border-radius: 16px;
    text-align: center;
    border: 2px dashed #d1d5db;
}

.print-title {
    font-size: 16px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 8px;
}

.print-desc {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 16px;
}

.print-buttons {
    display: flex;
    gap: 12px;
    justify-content: center;
}

@media (max-width: 1200px) {
    .content-grid {
        grid-template-columns: 1fr;
    }
    
    .evaluation-meta {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 768px) {
    .detail-header {
        padding: 24px;
    }
    
    .header-main {
        flex-direction: column;
        gap: 20px;
    }
    
    .employee-profile {
        flex-direction: column;
        text-align: center;
    }
    
    .action-buttons {
        width: 100%;
        justify-content: center;
    }
    
    .evaluation-meta {
        grid-template-columns: 1fr;
    }
    
    .content-card {
        padding: 20px;
    }
    
    .competency-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
    
    .goal-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }
}

@media print {
    .detail-header {
        background: #f3f4f6 !important;
        color: #1f2937 !important;
    }
    
    .action-buttons,
    .print-section {
        display: none !important;
    }
    
    .content-card {
        box-shadow: none !important;
        border: 1px solid #e5e7eb !important;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="evaluation-detail-container mx-auto">
    <!-- Header -->
    <div class="detail-header">
        <div class="header-main">
            <div class="employee-profile">
                <div class="employee-avatar">
                    {{ evaluation.employee.first_name.0 }}{{ evaluation.employee.last_name.0 }}
                </div>
                
                <div class="employee-info">
                    <h1>{{ evaluation.employee.first_name }} {{ evaluation.employee.last_name }}</h1>
                    <p class="employee-position">{{ evaluation.employee.job_position.title|default:"N/A" }}</p>
                    <p class="employee-department">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                        </svg>
                        {{ evaluation.employee.department.name|default:"N/A" }}
                    </p>
                </div>
            </div>
            
            <div class="status-badge {% if evaluation.is_completed %}status-completed{% elif evaluation.is_in_progress %}status-in-progress{% else %}status-pending{% endif %}">
                {% if evaluation.is_completed %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Concluída
                {% elif evaluation.is_in_progress %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                    </svg>
                    Em Andamento
                {% else %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Pendente
                {% endif %}
            </div>
        </div>
        
        <div class="evaluation-meta">
            <div class="meta-item">
                <div class="meta-value">{{ evaluation.overall_score|floatformat:1|default:"--" }}</div>
                <div class="meta-label">Pontuação Geral</div>
            </div>
            
            <div class="meta-item">
                <div class="meta-value">{{ evaluation.competencies_count|default:"0" }}</div>
                <div class="meta-label">Competências</div>
            </div>
            
            <div class="meta-item">
                <div class="meta-value">{{ evaluation.goals_completion|default:"0" }}%</div>
                <div class="meta-label">Metas Concluídas</div>
            </div>
            
            <div class="meta-item">
                <div class="meta-value">{{ evaluation.days_in_period|default:"--" }}</div>
                <div class="meta-label">Dias no Período</div>
            </div>
        </div>
        
        <div class="action-buttons">
            {% if not evaluation.is_completed %}
            <a href="{% url 'hr:evaluation_edit' evaluation.id %}" class="btn-action btn-primary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                </svg>
                Editar
            </a>
            
            <a href="{% url 'hr:evaluation_complete' evaluation.id %}" class="btn-action btn-secondary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Concluir
            </a>
            {% endif %}
            
            <button onclick="window.print()" class="btn-action btn-secondary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                </svg>
                Imprimir
            </button>
            
            <a href="{% url 'hr:evaluation_list' %}" class="btn-action btn-secondary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                Voltar
            </a>
        </div>
    </div>

    <!-- Content Grid -->
    <div class="content-grid">
        <!-- Main Content -->
        <div class="main-content">
            <!-- Competências -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="w-6 h-6 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        Avaliação de Competências
                    </h2>
                    
                    {% if not evaluation.is_completed %}
                    <a href="{% url 'hr:evaluation_edit' evaluation.id %}#competencies" class="card-action">
                        Editar
                    </a>
                    {% endif %}
                </div>
                
                <div class="competencies-grid">
                    {% for competency in evaluation.competencies.all %}
                    <div class="competency-item">
                        <div class="competency-header">
                            <div class="competency-name">{{ competency.name }}</div>
                            
                            <div class="competency-rating">
                                <div class="rating-stars">
                                    {% for i in "12345" %}
                                        <svg class="star {% if forloop.counter <= competency.rating %}filled{% endif %}" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                        </svg>
                                    {% endfor %}
                                </div>
                                <div class="rating-value">{{ competency.rating|floatformat:1 }}</div>
                            </div>
                        </div>
                        
                        {% if competency.comment %}
                        <div class="competency-comment">
                            "{{ competency.comment }}"
                        </div>
                        {% endif %}
                    </div>
                    {% empty %}
                    <div class="text-center text-gray-500 py-8">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                        </svg>
                        <p>Nenhuma competência avaliada ainda</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Metas -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="w-6 h-6 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"/>
                        </svg>
                        Metas e Objetivos
                    </h2>
                    
                    {% if not evaluation.is_completed %}
                    <a href="{% url 'hr:evaluation_edit' evaluation.id %}#goals" class="card-action">
                        Editar
                    </a>
                    {% endif %}
                </div>
                
                <div class="goals-list">
                    {% for goal in evaluation.goals.all %}
                    <div class="goal-item">
                        <div class="goal-header">
                            <div>
                                <div class="goal-title">{{ goal.title }}</div>
                            </div>
                            
                            <div class="goal-status {% if goal.progress >= 100 %}goal-completed{% elif goal.progress > 0 %}goal-in-progress{% else %}goal-not-started{% endif %}">
                                {% if goal.progress >= 100 %}
                                    <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                    </svg>
                                    Concluída
                                {% elif goal.progress > 0 %}
                                    <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                                    </svg>
                                    Em Progresso
                                {% else %}
                                    <svg class="w-3 h-3 inline mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3"/>
                                    </svg>
                                    Não Iniciada
                                {% endif %}
                            </div>
                        </div>
                        
                        {% if goal.description %}
                        <div class="goal-description">
                            {{ goal.description }}
                        </div>
                        {% endif %}
                        
                        <div class="goal-progress">
                            <div class="progress-header">
                                <span>Progresso</span>
                                <span>{{ goal.progress|default:0 }}%</span>
                            </div>
                            <div class="progress-bar">
                                <div class="progress-fill" data-progress="{{ goal.progress|default:0 }}"></div>
                            </div>
                        </div>
                    </div>
                    {% empty %}
                    <div class="text-center text-gray-500 py-8">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                        <p>Nenhuma meta definida ainda</p>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Feedback -->
            <div class="content-card">
                <div class="card-header">
                    <h2 class="card-title">
                        <svg class="w-6 h-6 text-indigo-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        Feedback e Comentários
                    </h2>
                    
                    {% if not evaluation.is_completed %}
                    <a href="{% url 'hr:evaluation_edit' evaluation.id %}#feedback" class="card-action">
                        Editar
                    </a>
                    {% endif %}
                </div>
                
                <div class="feedback-sections">
                    {% if evaluation.strengths_feedback %}
                    <div class="feedback-section strengths">
                        <div class="feedback-title">
                            <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                            </svg>
                            Pontos Fortes
                        </div>
                        <div class="feedback-content">{{ evaluation.strengths_feedback }}</div>
                    </div>
                    {% endif %}
                    
                    {% if evaluation.improvements_feedback %}
                    <div class="feedback-section improvements">
                        <div class="feedback-title">
                            <svg class="w-5 h-5 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                            </svg>
                            Oportunidades de Melhoria
                        </div>
                        <div class="feedback-content">{{ evaluation.improvements_feedback }}</div>
                    </div>
                    {% endif %}
                    
                    {% if evaluation.future_goals %}
                    <div class="feedback-section goals">
                        <div class="feedback-title">
                            <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v10a2 2 0 002 2h8a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                            </svg>
                            Metas Futuras
                        </div>
                        <div class="feedback-content">{{ evaluation.future_goals }}</div>
                    </div>
                    {% endif %}
                    
                    {% if evaluation.general_comments %}
                    <div class="feedback-section">
                        <div class="feedback-title">
                            <svg class="w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 8h10M7 12h4m1 8l-4-4H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-3l-4 4z"/>
                            </svg>
                            Comentários Gerais
                        </div>
                        <div class="feedback-content">{{ evaluation.general_comments }}</div>
                    </div>
                    {% endif %}
                    
                    {% if not evaluation.strengths_feedback and not evaluation.improvements_feedback and not evaluation.future_goals and not evaluation.general_comments %}
                    <div class="text-center text-gray-500 py-8">
                        <svg class="w-12 h-12 mx-auto mb-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                        </svg>
                        <p>Nenhum feedback adicionado ainda</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="sidebar">
            <!-- Informações da Avaliação -->
            <div class="sidebar-card">
                <h3 class="card-title">
                    <svg class="w-5 h-5 text-pink-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Informações da Avaliação
                </h3>
                
                <div class="space-y-4 mt-4">
                    <div>
                        <div class="text-xs font-semibold text-gray-500 uppercase">Tipo</div>
                        <div class="text-sm font-medium text-gray-900">
                            {% if evaluation.evaluation_type == 'quarterly' %}Trimestral
                            {% elif evaluation.evaluation_type == 'annual' %}Anual  
                            {% elif evaluation.evaluation_type == 'probationary' %}Experiência
                            {% elif evaluation.evaluation_type == 'performance' %}Performance
                            {% else %}{{ evaluation.evaluation_type|title }}
                            {% endif %}
                        </div>
                    </div>
                    
                    <div>
                        <div class="text-xs font-semibold text-gray-500 uppercase">Período</div>
                        <div class="text-sm font-medium text-gray-900">
                            {{ evaluation.start_date|date:"d/m/Y" }} - {{ evaluation.end_date|date:"d/m/Y" }}
                        </div>
                    </div>
                    
                    <div>
                        <div class="text-xs font-semibold text-gray-500 uppercase">Criada em</div>
                        <div class="text-sm font-medium text-gray-900">
                            {{ evaluation.created_at|date:"d/m/Y H:i" }}
                        </div>
                    </div>
                    
                    {% if evaluation.is_completed %}
                    <div>
                        <div class="text-xs font-semibold text-gray-500 uppercase">Concluída em</div>
                        <div class="text-sm font-medium text-gray-900">
                            {{ evaluation.completed_at|date:"d/m/Y H:i" }}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- Estatísticas -->
            <div class="sidebar-card">
                <h3 class="card-title">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    Estatísticas
                </h3>
                
                <div class="stats-overview">
                    <div class="stat-card">
                        <div class="stat-value">{{ evaluation.competencies_avg|floatformat:1|default:"--" }}</div>
                        <div class="stat-label">Média Competências</div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-value">{{ evaluation.goals_completion|default:"0" }}%</div>
                        <div class="stat-label">Metas Concluídas</div>
                    </div>
                </div>
            </div>

            <!-- Avaliador -->
            <div class="sidebar-card">
                <h3 class="card-title">
                    <svg class="w-5 h-5 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                    </svg>
                    Avaliador
                </h3>
                
                <div class="evaluator-info">
                    <div class="evaluator-avatar">
                        {{ evaluation.evaluator.first_name.0 }}{{ evaluation.evaluator.last_name.0 }}
                    </div>
                    
                    <div class="evaluator-details">
                        <div class="evaluator-name">
                            {{ evaluation.evaluator.first_name }} {{ evaluation.evaluator.last_name }}
                        </div>
                        <div class="evaluator-role">
                            {{ evaluation.evaluator.job_position.title|default:"Avaliador" }}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Timeline -->
            <div class="sidebar-card">
                <h3 class="card-title">
                    <svg class="w-5 h-5 text-purple-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                    </svg>
                    Histórico
                </h3>
                
                <div class="timeline">
                    <div class="timeline-item">
                        <div class="timeline-icon created">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-title">Avaliação Criada</div>
                            <div class="timeline-desc">Iniciado processo de avaliação</div>
                            <div class="timeline-date">{{ evaluation.created_at|date:"d/m/Y H:i" }}</div>
                        </div>
                    </div>
                    
                    {% if evaluation.updated_at != evaluation.created_at %}
                    <div class="timeline-item">
                        <div class="timeline-icon updated">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-title">Última Atualização</div>
                            <div class="timeline-desc">Dados modificados</div>
                            <div class="timeline-date">{{ evaluation.updated_at|date:"d/m/Y H:i" }}</div>
                        </div>
                    </div>
                    {% endif %}
                    
                    {% if evaluation.is_completed %}
                    <div class="timeline-item">
                        <div class="timeline-icon completed">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                            </svg>
                        </div>
                        <div class="timeline-content">
                            <div class="timeline-title">Avaliação Concluída</div>
                            <div class="timeline-desc">Processo finalizado</div>
                            <div class="timeline-date">{{ evaluation.completed_at|date:"d/m/Y H:i" }}</div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- Seção de Impressão -->
    <div class="print-section">
        <div class="print-title">Opções de Exportação</div>
        <div class="print-desc">Exporte ou imprima esta avaliação para arquivos ou documentação</div>
        
        <div class="print-buttons">
            <button onclick="window.print()" class="btn-action btn-primary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
                </svg>
                Imprimir PDF
            </button>
            
            <a href="{% url 'hr:evaluation_export' evaluation.id %}" class="btn-action btn-secondary">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                Exportar Excel
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Smooth scroll para âncoras
document.addEventListener('DOMContentLoaded', function() {
    // Configurar barras de progresso
    document.querySelectorAll('.progress-fill[data-progress]').forEach(progressBar => {
        const progress = progressBar.getAttribute('data-progress');
        progressBar.style.width = progress + '%';
    });
    
    // Scroll suave para links âncoras
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });
    
    // Animação das estrelas de rating
    document.querySelectorAll('.rating-stars').forEach(starsContainer => {
        const stars = starsContainer.querySelectorAll('.star');
        
        stars.forEach((star, index) => {
            star.addEventListener('mouseenter', function() {
                for (let i = 0; i <= index; i++) {
                    stars[i].classList.add('filled');
                }
            });
        });
        
        starsContainer.addEventListener('mouseleave', function() {
            // Restaurar estado original baseado no rating
            stars.forEach(star => {
                star.classList.remove('filled');
            });
            
            // Adicionar classe filled para estrelas que devem estar preenchidas
            const ratingValue = parseFloat(starsContainer.parentElement.querySelector('.rating-value').textContent);
            const filledStars = Math.floor(ratingValue);
            
            for (let i = 0; i < filledStars; i++) {
                stars[i].classList.add('filled');
            }
        });
    });
    
    // Tooltip para itens de timeline
    document.querySelectorAll('.timeline-item').forEach(item => {
        item.addEventListener('mouseenter', function() {
            this.style.backgroundColor = '#f3f4f6';
        });
        
        item.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '#f9fafb';
        });
    });
    
    // Contador animado para métricas
    function animateCounters() {
        document.querySelectorAll('.meta-value, .stat-value').forEach(counter => {
            const target = parseFloat(counter.textContent);
            if (isNaN(target)) return;
            
            let current = 0;
            const increment = target / 50;
            const timer = setInterval(() => {
                current += increment;
                if (current >= target) {
                    counter.textContent = target % 1 === 0 ? target : target.toFixed(1);
                    clearInterval(timer);
                } else {
                    counter.textContent = current % 1 === 0 ? Math.floor(current) : current.toFixed(1);
                }
            }, 20);
        });
    }
    
    // Executar animação quando a página carregar
    setTimeout(animateCounters, 500);
    
    // Observador de interseção para animações
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, {
        threshold: 0.1
    });
    
    // Aplicar observer aos cards
    document.querySelectorAll('.content-card, .sidebar-card').forEach(card => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        card.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(card);
    });
});

// Função para imprimir com estilos otimizados
function printEvaluation() {
    // Adicionar estilos específicos para impressão
    const printStyles = `
        <style>
            @media print {
                body { font-size: 12px; }
                .detail-header { page-break-inside: avoid; }
                .content-card { page-break-inside: avoid; margin-bottom: 20px; }
                .competency-item, .goal-item { page-break-inside: avoid; }
                .sidebar { display: none; }
                .content-grid { grid-template-columns: 1fr; }
            }
        </style>
    `;
    
    document.head.insertAdjacentHTML('beforeend', printStyles);
    window.print();
}

// Atalhos de teclado
document.addEventListener('keydown', function(e) {
    if (e.ctrlKey || e.metaKey) {
        switch(e.key) {
            case 'p':
                e.preventDefault();
                printEvaluation();
                break;
            case 'e':
                e.preventDefault();
                window.location.href = '{% url "hr:evaluation_edit" evaluation.id %}';
                break;
            case 'b':
                e.preventDefault();
                window.location.href = '{% url "hr:evaluation_list" %}';
                break;
        }
    }
});
</script>
{% endblock %}
