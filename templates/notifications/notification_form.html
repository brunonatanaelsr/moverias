{% extends 'base_optimized.html' %}

{% block title %}{% if object %}Editar{% else %}Criar{% endif %} Notifica√ß√£o - Move Marias{% endblock %}

{% block extra_css %}
<style>
    .dashboard-fade-in {
        animation: fadeIn 0.4s ease-out;
    }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .preview-card {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        padding: 1.5rem;
        color: white;
        box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<a href="{% url 'notifications:list' %}" class="text-gray-500 hover:text-gray-700">Notifica√ß√µes</a>
<span class="text-gray-900">{% if object %}Editar{% else %}Criar{% endif %}</span>
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
    <div class="section-spacing-lg">
        <div class="max-w-4xl mx-auto">
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <div class="flex items-center mb-6">
                    <div class="flex-shrink-0">
                        <div class="w-12 h-12 bg-purple-100 rounded-lg flex items-center justify-center">
                            <i class="fas fa-bell text-purple-600 text-xl"></i>
                        </div>
                    </div>
                    <div class="ml-4">
                        <h1 class="text-2xl font-bold text-gray-900">
                            {% if object %}Editar Notifica√ß√£o{% else %}Criar Nova Notifica√ß√£o{% endif %}
                        </h1>
                        <p class="mt-1 text-sm text-gray-600">
                            {% if object %}Atualize as informa√ß√µes da notifica√ß√£o{% else %}Crie uma nova notifica√ß√£o para os usu√°rios{% endif %}
                        </p>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Formul√°rio -->
                    <div>
                        <form method="post" id="notification-form">
                            {% csrf_token %}
                            
                            <!-- T√≠tulo -->
                            <div class="form-group">
                                <label for="id_title" class="block text-sm font-medium text-gray-700 mb-2">
                                    T√≠tulo da Notifica√ß√£o <span class="text-red-500">*</span>
                                </label>
                                {{ form.title }}
                                {% if form.title.errors %}
                                    <div class="mt-1 text-sm text-red-600">
                                        {{ form.title.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Mensagem -->
                            <div class="form-group">
                                <label for="id_message" class="block text-sm font-medium text-gray-700 mb-2">
                                    Mensagem <span class="text-red-500">*</span>
                                </label>
                                {{ form.message }}
                                {% if form.message.errors %}
                                    <div class="mt-1 text-sm text-red-600">
                                        {{ form.message.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Destinat√°rio -->
                            <div class="form-group">
                                <label for="id_recipient" class="block text-sm font-medium text-gray-700 mb-2">
                                    Destinat√°rio <span class="text-red-500">*</span>
                                </label>
                                {{ form.recipient }}
                                {% if form.recipient.errors %}
                                    <div class="mt-1 text-sm text-red-600">
                                        {{ form.recipient.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Tipo -->
                            <div class="form-group">
                                <label for="id_type" class="block text-sm font-medium text-gray-700 mb-2">
                                    Tipo de Notifica√ß√£o
                                </label>
                                {{ form.type }}
                                {% if form.type.errors %}
                                    <div class="mt-1 text-sm text-red-600">
                                        {{ form.type.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Prioridade -->
                            <div class="form-group">
                                <label for="id_priority" class="block text-sm font-medium text-gray-700 mb-2">
                                    Prioridade
                                </label>
                                {{ form.priority }}
                                {% if form.priority.errors %}
                                    <div class="mt-1 text-sm text-red-600">
                                        {{ form.priority.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>

                            <!-- Canal -->
                            {% if form.channel %}
                            <div class="form-group">
                                <label for="id_channel" class="block text-sm font-medium text-gray-700 mb-2">
                                    Canal de Envio
                                </label>
                                {{ form.channel }}
                                {% if form.channel.errors %}
                                    <div class="mt-1 text-sm text-red-600">
                                        {{ form.channel.errors.0 }}
                                    </div>
                                {% endif %}
                            </div>
                            {% endif %}

                            <!-- Bot√µes -->
                            <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200">
                                <a href="{% url 'notifications:list' %}" 
                                   class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                                    <i class="fas fa-times mr-2"></i>
                                    Cancelar
                                </a>
                                <button type="submit" 
                                        class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-purple-600 hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-purple-500">
                                    <i class="fas fa-save mr-2"></i>
                                    {% if object %}Atualizar{% else %}Criar{% endif %} Notifica√ß√£o
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- Preview -->
                    <div>
                        <h3 class="text-lg font-medium text-gray-900 mb-4">Preview da Notifica√ß√£o</h3>
                        
                        <div class="preview-card" id="notification-preview">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0">
                                    <div class="w-10 h-10 bg-white bg-opacity-20 rounded-lg flex items-center justify-center">
                                        <i class="fas fa-bell text-white"></i>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <h4 class="font-semibold text-white" id="preview-title">
                                        {% if object %}{{ object.title }}{% else %}T√≠tulo da notifica√ß√£o aparecer√° aqui{% endif %}
                                    </h4>
                                    <p class="text-sm text-white text-opacity-90 mt-1" id="preview-message">
                                        {% if object %}{{ object.message }}{% else %}A mensagem da notifica√ß√£o aparecer√° aqui{% endif %}
                                    </p>
                                    <div class="flex items-center space-x-4 mt-3 text-xs text-white text-opacity-70">
                                        <span id="preview-type">üì¢ Geral</span>
                                        <span id="preview-priority">‚≠ê Normal</span>
                                        <span>üïí Agora</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Dicas -->
                        <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                            <h4 class="text-sm font-medium text-blue-900 mb-2">
                                <i class="fas fa-lightbulb mr-1"></i>
                                Dicas para uma boa notifica√ß√£o:
                            </h4>
                            <ul class="text-sm text-blue-800 space-y-1">
                                <li>‚Ä¢ Use um t√≠tulo claro e objetivo</li>
                                <li>‚Ä¢ Mantenha a mensagem concisa</li>
                                <li>‚Ä¢ Escolha a prioridade adequada</li>
                                <li>‚Ä¢ Selecione o destinat√°rio correto</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const titleInput = document.getElementById('id_title');
    const messageInput = document.getElementById('id_message');
    const typeSelect = document.getElementById('id_type');
    const prioritySelect = document.getElementById('id_priority');
    
    const previewTitle = document.getElementById('preview-title');
    const previewMessage = document.getElementById('preview-message');
    const previewType = document.getElementById('preview-type');
    const previewPriority = document.getElementById('preview-priority');
    
    // Mapeamento de tipos
    const typeIcons = {
        'general': 'üì¢',
        'system': '‚öôÔ∏è',
        'workshop_enrollment': 'üéì',
        'certificate_ready': 'üèÜ',
        'coaching_scheduled': 'üíº',
        'welcome': 'üëã'
    };
    
    const priorityIcons = {
        '1': 'üî¥',
        '2': '‚≠ê',
        '3': 'üî•',
        '4': 'üö®'
    };
    
    // Atualizar preview em tempo real
    function updatePreview() {
        if (titleInput.value) {
            previewTitle.textContent = titleInput.value;
        } else {
            previewTitle.textContent = 'T√≠tulo da notifica√ß√£o aparecer√° aqui';
        }
        
        if (messageInput.value) {
            previewMessage.textContent = messageInput.value;
        } else {
            previewMessage.textContent = 'A mensagem da notifica√ß√£o aparecer√° aqui';
        }
        
        if (typeSelect) {
            const selectedType = typeSelect.value;
            const icon = typeIcons[selectedType] || 'üì¢';
            const text = typeSelect.options[typeSelect.selectedIndex].text;
            previewType.textContent = `${icon} ${text}`;
        }
        
        if (prioritySelect) {
            const selectedPriority = prioritySelect.value;
            const icon = priorityIcons[selectedPriority] || '‚≠ê';
            const text = prioritySelect.options[prioritySelect.selectedIndex].text;
            previewPriority.textContent = `${icon} ${text}`;
        }
    }
    
    // Event listeners
    if (titleInput) titleInput.addEventListener('input', updatePreview);
    if (messageInput) messageInput.addEventListener('input', updatePreview);
    if (typeSelect) typeSelect.addEventListener('change', updatePreview);
    if (prioritySelect) prioritySelect.addEventListener('change', updatePreview);
    
    // Update inicial
    updatePreview();
});
</script>
{% endblock %}
