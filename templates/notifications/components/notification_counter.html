{% load notification_tags %}

<div class="notification-counter relative">
    <a href="{% url 'notifications:list' %}" class="mm-btn mm-btn-outline-primary relative">
        <i class="fas fa-bell"></i>
        <span class="ml-2 hidden md:inline">Notificações</span>
        {% if count > 0 %}
        <span class="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">
            {{ count }}
            <span class="sr-only">notificações não lidas</span>
        </span>
        {% endif %}
    </a>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Atualizar contador a cada 30 segundos
    setInterval(function() {
        fetch('{% url "notifications:count" %}')
            .then(response => response.json())
            .then(data => {
                const badge = document.querySelector('.notification-counter .badge');
                if (data.count > 0) {
                    if (badge) {
                        badge.textContent = data.count;
                    } else {
                        // Criar badge se não existir
                        const newBadge = document.createElement('span');
                        newBadge.className = 'position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger';
                        newBadge.innerHTML = data.count + '<span class="visually-hidden">notificações não lidas</span>';
                        document.querySelector('.notification-counter a').appendChild(newBadge);
                    }
                } else {
                    if (badge) {
                        badge.remove();
                    }
                }
            })
            .catch(error => console.error('Erro ao atualizar contador:', error));
    }, 30000);
});
</script>
