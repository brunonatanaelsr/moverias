{% extends 'base_optimized.html' %}
{% load static %}

{% block title %}Dashboard - Move Marias{% endblock %}

{% block page_title %}Dashboard{% endblock %}

{% block extra_css %}
<!-- Dashboard specific optimizations -->
<style>
    /* Dashboard specific animations */
    .dashboard-fade-in {
        animation: fadeIn 0.4s ease-out;
    }
    
    .dashboard-slide-up {
        animation: slideUp 0.5s ease-out;
    }
    
    .dashboard-slide-up:nth-child(1) { animation-delay: 0.1s; }
    .dashboard-slide-up:nth-child(2) { animation-delay: 0.2s; }
    .dashboard-slide-up:nth-child(3) { animation-delay: 0.3s; }
    .dashboard-slide-up:nth-child(4) { animation-delay: 0.4s; }
    
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes slideUp {
        from { 
            opacity: 0;
            transform: translateY(15px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Loading states */
    .dashboard-loading {
        opacity: 0.6;
        pointer-events: none;
        position: relative;
    }
    
    .dashboard-loading::after {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 16px;
        height: 16px;
        border: 2px solid #e5e7eb;
        border-top: 2px solid #7c3aed;
        border-radius: 50%;
        animation: spin 1s linear infinite;
        transform: translate(-50%, -50%);
    }
    
    @keyframes spin {
        0% { transform: translate(-50%, -50%) rotate(0deg); }
        100% { transform: translate(-50%, -50%) rotate(360deg); }
    }
    
    /* Hover effects */
    .dashboard-card-hover:hover {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px -5px rgba(0, 0, 0, 0.1);
    }
    
    /* Stats number animation */
    .stats-number {
        font-variant-numeric: tabular-nums;
        transition: all 0.3s ease;
    }
    
    .stats-card:hover .stats-number {
        transform: scale(1.05);
    }
</style>
{% endblock %}

{% block breadcrumb_items %}
<!-- Dashboard doesn't need additional breadcrumb items -->
{% endblock %}

{% block content %}
<div class="dashboard-container-optimized">
    <!-- Welcome Header -->
    <div class="dashboard-header-optimized dashboard-fade-in">
        <div class="dashboard-header-content-optimized">
            <div class="dashboard-header-icon">üíú</div>
            <div class="dashboard-header-text">
                <h1>Bem-vinda, {{ user.get_full_name|default:user.username }}!</h1>
                <p>Transformando vidas atrav√©s do cuidado e empoderamento feminino</p>
            </div>
        </div>
        <div class="hidden lg:block text-right">
            <div class="text-sm opacity-90">{{ "now"|date:"l, d \d\e F \d\e Y" }}</div>
            <div class="text-xl font-bold">{{ "now"|date:"H:i" }}</div>
        </div>
    </div>

    <!-- Stats Cards -->
    <div class="grid-optimized grid-optimized-4 section-spacing-md">
        <!-- Benefici√°rias -->
        <div class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up stats-card" dashboard-card-hover dashboard-slide-up>
            <div class="flex-between">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Benefici√°rias</p>
                    <p class="text-2xl font-bold text-move-purple-700 dark:text-move-purple-300 stats-number">{{ stats.total_beneficiarias|default:0 }}</p>
                </div>
                <div class="w-10 h-10 bg-move-purple-100 dark:bg-move-purple-900 rounded-lg flex-center">
                    <i class="fas fa-users text-move-purple-600 dark:text-move-purple-400"></i>
                </div>
            </div>
        </div>

        <!-- Projetos Ativos -->
        <div class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up stats-card" dashboard-card-hover dashboard-slide-up>
            <div class="flex-between">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Projetos Ativos</p>
                    <p class="text-2xl font-bold text-green-600 dark:text-green-400 stats-number">{{ stats.projetos_ativos|default:0 }}</p>
                </div>
                <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex-center">
                    <i class="fas fa-project-diagram text-green-600 dark:text-green-400"></i>
                </div>
            </div>
        </div>

        <!-- Workshops -->
        <div class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up stats-card" dashboard-card-hover dashboard-slide-up>
            <div class="flex-between">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Workshops</p>
                    <p class="text-2xl font-bold text-blue-600 dark:text-blue-400 stats-number">{{ stats.workshops|default:0 }}</p>
                </div>
                <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex-center">
                    <i class="fas fa-chalkboard-teacher text-blue-600 dark:text-blue-400"></i>
                </div>
            </div>
        </div>

        <!-- Certificados -->
        <div class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up stats-card" dashboard-card-hover dashboard-slide-up>
            <div class="flex-between">
                <div>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Certificados</p>
                    <p class="text-2xl font-bold text-amber-600 dark:text-amber-400 stats-number">{{ stats.certificados|default:0 }}</p>
                </div>
                <div class="w-10 h-10 bg-amber-100 dark:bg-amber-900 rounded-lg flex-center">
                    <i class="fas fa-certificate text-amber-600 dark:text-amber-400"></i>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="section-spacing-md">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">A√ß√µes R√°pidas</h2>
        <div class="grid-optimized grid-optimized-3">
            <!-- Nova Benefici√°ria -->
            <a href="{% url 'members:beneficiary-create' %}" 
               class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up group">
                <div class="flex-start">
                    <div class="w-10 h-10 bg-move-purple-100 dark:bg-move-purple-900 rounded-lg flex-center mr-3 group-hover:bg-move-purple-200 dark:group-hover:bg-move-purple-800 transition-colors">
                        <i class="fas fa-user-plus text-move-purple-600 dark:text-move-purple-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Nova Benefici√°ria</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Cadastrar nova benefici√°ria</p>
                    </div>
                </div>
            </a>

            <!-- Novo Projeto -->
            <a href="{% url 'projects:project-create' %}" 
               class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up group">
                <div class="flex-start">
                    <div class="w-10 h-10 bg-green-100 dark:bg-green-900 rounded-lg flex-center mr-3 group-hover:bg-green-200 dark:group-hover:bg-green-800 transition-colors">
                        <i class="fas fa-plus text-green-600 dark:text-green-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Novo Projeto</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Criar novo projeto</p>
                    </div>
                </div>
            </a>

            <!-- Novo Workshop -->
            <a href="{% url 'workshops:workshop-create' %}" 
               class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up group">
                <div class="flex-start">
                    <div class="w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-lg flex-center mr-3 group-hover:bg-blue-200 dark:group-hover:bg-blue-800 transition-colors">
                        <i class="fas fa-calendar-plus text-blue-600 dark:text-blue-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Novo Workshop</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Agendar workshop</p>
                    </div>
                </div>
            </a>
        </div>
    </div>

    <!-- Recent Activity -->
    <div class="section-spacing-md">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Atividade Recente</h2>
        <div class="card-optimized card-padding-lg card-height-lg dashboard-card-hover dashboard-slide-up" dashboard-card-hover dashboard-slide-up>
            <div class="space-y-3">
                {% for activity in recent_activities %}
                <div class="flex-start">
                    <div class="w-8 h-8 bg-gray-100 dark:bg-gray-700 rounded-full flex-center mr-3">
                        <i class="fas fa-{{ activity.icon }} text-gray-500 dark:text-gray-400 text-xs"></i>
                    </div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-900 dark:text-gray-100">{{ activity.description }}</p>
                        <p class="text-xs text-gray-500 dark:text-gray-400">{{ activity.created_at|timesince }} atr√°s</p>
                    </div>
                </div>
                {% empty %}
                <div class="text-center py-8">
                    <i class="fas fa-clock text-gray-400 dark:text-gray-500 text-2xl mb-2"></i>
                    <p class="text-sm text-gray-500 dark:text-gray-400">Nenhuma atividade recente</p>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <!-- Admin Tools - Only for staff -->
    {% if user.is_staff %}
    <div class="section-spacing-md">
        <h2 class="text-lg font-semibold text-gray-900 dark:text-gray-100 mb-4">Ferramentas Administrativas</h2>
        <div class="grid-optimized grid-optimized-2">
            <!-- System Monitoring -->
            <a href="{% url 'core:monitoring_dashboard' %}" 
               class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up group">
                <div class="flex-start">
                    <div class="w-10 h-10 bg-red-100 dark:bg-red-900 rounded-lg flex-center mr-3 group-hover:bg-red-200 dark:group-hover:bg-red-800 transition-colors">
                        <i class="fas fa-chart-area text-red-600 dark:text-red-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Monitoramento</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Acessar dashboard de monitoramento</p>
                    </div>
                </div>
            </a>

            <!-- Configuration -->
            <a href="{% url 'core:settings' %}" 
               class="card-optimized card-padding-md card-height-sm dashboard-card-hover dashboard-slide-up group">
                <div class="flex-start">
                    <div class="w-10 h-10 bg-gray-100 dark:bg-gray-700 rounded-lg flex-center mr-3 group-hover:bg-gray-200 dark:group-hover:bg-gray-600 transition-colors">
                        <i class="fas fa-cogs text-gray-600 dark:text-gray-400"></i>
                    </div>
                    <div>
                        <h3 class="text-sm font-semibold text-gray-900 dark:text-gray-100">Configura√ß√µes</h3>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">Configurar sistema</p>
                    </div>
                </div>
            </a>
        </div>
    </div>
    {% endif %}
</div>

<!-- Dashboard JavaScript -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize dashboard animations
        const cards = document.querySelectorAll('.dashboard-card-hover');
        
        // Add stagger effect to cards
        cards.forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
        });
        
        // Smooth scroll for internal links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({
                        behavior: 'smooth'
                    });
                }
            });
        });
        
        // Loading state handler
        function showLoading(element) {
            element.classList.add('dashboard-loading');
        }
        
        function hideLoading(element) {
            element.classList.remove('dashboard-loading');
        }
        
        // Add loading states to action cards
        document.querySelectorAll('.card-optimized a, .dashboard-card-hover a').forEach(link => {
            link.addEventListener('click', function(e) {
                if (this.href && !this.href.startsWith('#')) {
                    showLoading(this.closest('.card-optimized'));
                }
            });
        });
        
        // Auto-refresh stats (every 5 minutes)
        setInterval(function() {
            // Only refresh if user is active
            if (document.visibilityState === 'visible') {
                fetch(window.location.href + '?refresh=stats', {
                    method: 'GET',
                    headers: {
                        'X-Requested-With': 'XMLHttpRequest'
                    }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.stats) {
                        updateStats(data.stats);
                    }
                })
                .catch(error => console.log('Stats refresh failed:', error));
            }
        }, 300000); // 5 minutes
        
        function updateStats(stats) {
            const statElements = document.querySelectorAll('.stats-number');
            statElements.forEach(element => {
                const key = element.parentElement.parentElement.querySelector('p').textContent.toLowerCase();
                if (stats[key] !== undefined) {
                    element.textContent = stats[key];
                }
            });
        }
        
        // Animate stats numbers on page load
        const statsNumbers = document.querySelectorAll('.stats-number');
        statsNumbers.forEach(stat => {
            const finalNumber = parseInt(stat.textContent) || 0;
            if (finalNumber > 0) {
                let currentNumber = 0;
                const increment = finalNumber / 30; // Animate over 30 steps
                
                const animation = setInterval(() => {
                    currentNumber += increment;
                    if (currentNumber >= finalNumber) {
                        stat.textContent = finalNumber;
                        clearInterval(animation);
                    } else {
                        stat.textContent = Math.floor(currentNumber);
                    }
                }, 50);
            }
        });
    });
</script>
{% endblock %}
