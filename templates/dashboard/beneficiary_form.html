{% extends 'dashboard_base.html' %}
{% load crispy_forms_tags %}

{% block title %}
{% if beneficiary %}Editar Benefici√°ria{% else %}Nova Benefici√°ria{% endif %} - Move Marias
{% endblock %}

{% block content %}
<div class="mb-8">
    <div class="flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">
                {% if beneficiary %}Editar Benefici√°ria{% else %}Nova Benefici√°ria{% endif %}
            </h1>
            <p class="mt-2 text-sm text-gray-600">
                {% if beneficiary %}
                    Atualize as informa√ß√µes da benefici√°ria
                {% else %}
                    Preencha os dados para cadastrar uma nova benefici√°ria
                {% endif %}
            </p>
        </div>
        <a href="{% url 'dashboard:beneficiaries_list' %}" 
           class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
            ‚Üê Voltar
        </a>
    </div>
</div>

<div class="max-w-4xl">
    <form method="post" class="bg-white shadow rounded-lg">
        {% csrf_token %}
        
        <div class="px-6 py-8">
            <!-- Dados Pessoais -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4 border-b border-gray-200 pb-2">
                    üë§ Dados Pessoais
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="id_full_name" class="block text-sm font-medium text-gray-700 mb-2">
                            Nome Completo *
                        </label>
                        <input type="text" 
                               name="full_name" 
                               id="id_full_name"
                               value="{% if form.full_name.value %}{{ form.full_name.value }}{% endif %}"
                               required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.full_name.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.full_name.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_dob" class="block text-sm font-medium text-gray-700 mb-2">
                            Data de Nascimento *
                        </label>
                        <input type="date" 
                               name="dob" 
                               id="id_dob"
                               value="{% if form.dob.value %}{{ form.dob.value|date:'Y-m-d' }}{% endif %}"
                               required 
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.dob.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.dob.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_nis" class="block text-sm font-medium text-gray-700 mb-2">
                            NIS (opcional)
                        </label>
                        <input type="text" 
                               name="nis" 
                               id="id_nis"
                               value="{% if form.nis.value %}{{ form.nis.value }}{% endif %}"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.nis.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.nis.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Contato -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4 border-b border-gray-200 pb-2">
                    üìû Contato
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="id_phone_1" class="block text-sm font-medium text-gray-700 mb-2">
                            Telefone Principal *
                        </label>
                        <input type="tel" 
                               name="phone_1" 
                               id="id_phone_1"
                               value="{% if form.phone_1.value %}{{ form.phone_1.value }}{% endif %}"
                               required 
                               placeholder="(11) 99999-9999"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.phone_1.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.phone_1.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_phone_2" class="block text-sm font-medium text-gray-700 mb-2">
                            Telefone Secund√°rio (opcional)
                        </label>
                        <input type="tel" 
                               name="phone_2" 
                               id="id_phone_2"
                               value="{% if form.phone_2.value %}{{ form.phone_2.value }}{% endif %}"
                               placeholder="(11) 99999-9999"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.phone_2.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.phone_2.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Documentos -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4 border-b border-gray-200 pb-2">
                    üìÑ Documentos
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div>
                        <label for="id_rg" class="block text-sm font-medium text-gray-700 mb-2">
                            RG (opcional)
                        </label>
                        <input type="text" 
                               name="rg" 
                               id="id_rg"
                               value="{% if form.rg.value %}{{ form.rg.value }}{% endif %}"
                               placeholder="XX.XXX.XXX-X"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.rg.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.rg.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div>
                        <label for="id_cpf" class="block text-sm font-medium text-gray-700 mb-2">
                            CPF (opcional)
                        </label>
                        <input type="text" 
                               name="cpf" 
                               id="id_cpf"
                               value="{% if form.cpf.value %}{{ form.cpf.value }}{% endif %}"
                               placeholder="000.000.000-00"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                        {% if form.cpf.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.cpf.errors.0 }}</p>
                        {% endif %}
                    </div>
                </div>
            </div>

            <!-- Endere√ßo -->
            <div class="mb-8">
                <h3 class="text-lg font-medium text-gray-900 mb-4 border-b border-gray-200 pb-2">
                    üè† Endere√ßo
                </h3>
                <div class="space-y-6">
                    <div>
                        <label for="id_address" class="block text-sm font-medium text-gray-700 mb-2">
                            Endere√ßo Completo *
                        </label>
                        <textarea name="address" 
                                  id="id_address"
                                  rows="3"
                                  required 
                                  placeholder="Rua, n√∫mero, complemento, CEP..."
                                  class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">{% if form.address.value %}{{ form.address.value }}{% endif %}</textarea>
                        {% if form.address.errors %}
                            <p class="mt-1 text-sm text-red-600">{{ form.address.errors.0 }}</p>
                        {% endif %}
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="id_neighbourhood" class="block text-sm font-medium text-gray-700 mb-2">
                                Bairro *
                            </label>
                            <input type="text" 
                                   name="neighbourhood" 
                                   id="id_neighbourhood"
                                   value="{% if form.neighbourhood.value %}{{ form.neighbourhood.value }}{% endif %}"
                                   required 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                            {% if form.neighbourhood.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.neighbourhood.errors.0 }}</p>
                            {% endif %}
                        </div>
                        
                        <div>
                            <label for="id_reference" class="block text-sm font-medium text-gray-700 mb-2">
                                Ponto de Refer√™ncia
                            </label>
                            <input type="text" 
                                   name="reference" 
                                   id="id_reference"
                                   value="{% if form.reference.value %}{{ form.reference.value }}{% endif %}"
                                   placeholder="Pr√≥ximo ao..."
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-2 focus:ring-purple-move focus:border-purple-move">
                            {% if form.reference.errors %}
                                <p class="mt-1 text-sm text-red-600">{{ form.reference.errors.0 }}</p>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- A√ß√µes -->
        <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-end space-x-3">
            <a href="{% url 'dashboard:beneficiaries_list' %}" 
               class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                Cancelar
            </a>
            <button type="submit" 
                    class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-gradient-to-r from-purple-move to-pink-move hover:from-purple-700 hover:to-pink-600">
                {% if beneficiary %}üíæ Salvar Altera√ß√µes{% else %}‚ûï Cadastrar Benefici√°ria{% endif %}
            </button>
        </div>
    </form>
</div>

<script>
// M√°scaras para campos
document.addEventListener('DOMContentLoaded', function() {
    // M√°scara para telefone
    function phoneMask(input) {
        input.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            if (value.length <= 11) {
                value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                if (value.length === 14) {
                    this.value = value;
                } else if (value.length <= 10) {
                    value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                    this.value = value;
                }
            }
        });
    }
    
    // M√°scara para CPF
    function cpfMask(input) {
        input.addEventListener('input', function() {
            let value = this.value.replace(/\D/g, '');
            value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            this.value = value;
        });
    }
    
    // Aplicar m√°scaras
    const phone1 = document.getElementById('id_phone_1');
    const phone2 = document.getElementById('id_phone_2');
    const cpf = document.getElementById('id_cpf');
    
    if (phone1) phoneMask(phone1);
    if (phone2) phoneMask(phone2);
    if (cpf) cpfMask(cpf);
});
</script>
{% endblock %}
