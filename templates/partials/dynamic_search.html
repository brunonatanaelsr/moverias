<!-- Dynamic Search Component -->
<div class="relative">
    <div class="relative">
        <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
        </div>
        <input type="text" 
               name="search" 
               id="search-input"
               class="block w-full pl-10 pr-3 py-2 border border-gray-300 rounded-md leading-5 bg-white placeholder-gray-500 focus:outline-none focus:placeholder-gray-400 focus:ring-1 focus:ring-blue-500 focus:border-blue-500 sm:text-sm"
               placeholder="{{ placeholder|default:'Buscar...' }}"
               value="{{ search_query|default:'' }}"
               hx-get="{{ search_url }}"
               hx-trigger="keyup changed delay:500ms, search"
               hx-target="#search-results"
               hx-indicator="#search-loading"
               hx-include="[name='status'], [name='type'], [name='category']">
        
        <!-- Clear button -->
        <div class="absolute inset-y-0 right-0 pr-3 flex items-center">
            <button type="button" 
                    id="clear-search"
                    class="text-gray-400 hover:text-gray-600 {% if not search_query %}hidden{% endif %}"
                    onclick="clearSearch()">
                <svg class="h-5 w-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                </svg>
            </button>
        </div>
    </div>
    
    <!-- Loading indicator -->
    <div id="search-loading" class="htmx-indicator absolute top-2 right-8">
        <div class="animate-spin rounded-full h-4 w-4 border-b-2 border-blue-600"></div>
    </div>
</div>

<!-- Advanced filters (collapsible) -->
<div class="mt-4">
    <button type="button" 
            class="flex items-center text-sm text-gray-600 hover:text-gray-800"
            onclick="toggleFilters()"
            id="filter-toggle">
        <svg class="h-4 w-4 mr-1 transform transition-transform" id="filter-arrow" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path>
        </svg>
        Filtros avan√ßados
    </button>
    
    <div id="advanced-filters" class="hidden mt-3 p-4 bg-gray-50 rounded-lg space-y-3">
        {% block advanced_filters %}
        <!-- Custom filters will be inserted here by extending templates -->
        {% endblock %}
    </div>
</div>

<script>
function clearSearch() {
    const searchInput = document.getElementById('search-input');
    const clearButton = document.getElementById('clear-search');
    
    searchInput.value = '';
    clearButton.classList.add('hidden');
    
    // Trigger search to show all results
    htmx.trigger(searchInput, 'search');
}

function toggleFilters() {
    const filters = document.getElementById('advanced-filters');
    const arrow = document.getElementById('filter-arrow');
    
    filters.classList.toggle('hidden');
    arrow.classList.toggle('rotate-90');
}

// Show/hide clear button based on input
document.getElementById('search-input').addEventListener('input', function() {
    const clearButton = document.getElementById('clear-search');
    
    if (this.value.length > 0) {
        clearButton.classList.remove('hidden');
    } else {
        clearButton.classList.add('hidden');
    }
});
</script>

<style>
.htmx-indicator {
    opacity: 0;
    transition: opacity 200ms ease-in;
}

.htmx-request .htmx-indicator {
    opacity: 1;
}

.htmx-request.htmx-indicator {
    opacity: 1;
}
</style>
