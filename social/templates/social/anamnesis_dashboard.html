{% extends 'layouts/base.html' %}
{% load static %}

{% block title %}Dashboard Social{% endblock %}

{% block extra_css %}
<style>
.dashboard-header {
    background: linear-gradient(135deg, #8B5CF6 0%, #A78BFA 100%);
    color: white;
    border-radius: 12px;
    padding: 2rem;
    margin-bottom: 2rem;
}

.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    text-align: center;
    transition: transform 0.2s;
}

.stat-card:hover {
    transform: translateY(-2px);
}

.stat-value {
    font-size: 2.5rem;
    font-weight: bold;
    margin-bottom: 0.5rem;
}

.chart-card {
    background: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    padding: 1.5rem;
    margin-bottom: 2rem;
}

.progress-bar {
    width: 100%;
    height: 8px;
    background-color: #E5E7EB;
    border-radius: 4px;
    overflow: hidden;
    margin-top: 0.5rem;
}

.progress-fill {
    height: 100%;
    transition: width 0.3s ease;
}

.vulnerability-indicator {
    display: inline-block;
    width: 12px;
    height: 12px;
    border-radius: 50%;
    margin-right: 0.5rem;
}

.recent-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-bottom: 1px solid #E5E7EB;
    transition: background-color 0.2s;
}

.recent-item:hover {
    background-color: #F9FAFB;
}

.recent-item:last-child {
    border-bottom: none;
}

@media (max-width: 768px) {
    .dashboard-header {
        padding: 1.5rem;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 1rem;
    }
    
    .stat-card {
        padding: 1rem;
    }
    
    .stat-value {
        font-size: 2rem;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Header -->
    <div class="dashboard-header">
        <div class="flex flex-col md:flex-row md:items-center md:justify-between">
            <div>
                <h1 class="text-3xl font-bold mb-2">
                    <i class="fas fa-chart-pie mr-3"></i>
                    Dashboard Social
                </h1>
                <p class="text-purple-100">Visão geral das anamneses sociais e indicadores</p>
            </div>
            <div class="mt-4 md:mt-0 text-right">
                <p class="text-purple-200 text-sm">Última atualização</p>
                <p class="text-white font-semibold">{{ "now"|date:"d/m/Y H:i" }}</p>
            </div>
        </div>
    </div>

    <!-- Estatísticas Principais -->
    <div class="stats-grid">
        <div class="stat-card">
            <i class="fas fa-clipboard-list text-3xl text-purple-600 mb-3"></i>
            <div class="stat-value text-purple-600">45</div>
            <div class="text-gray-600 font-medium">Total de Anamneses</div>
            <div class="text-sm text-gray-500 mt-1">
                <i class="fas fa-arrow-up text-green-500 mr-1"></i>
                +5 este mês
            </div>
        </div>
        
        <div class="stat-card">
            <i class="fas fa-check-circle text-3xl text-green-600 mb-3"></i>
            <div class="stat-value text-green-600">32</div>
            <div class="text-gray-600 font-medium">Concluídas</div>
            <div class="progress-bar">
                <div class="progress-fill bg-green-500" style="width: 71%;"></div>
            </div>
        </div>
        
        <div class="stat-card">
            <i class="fas fa-edit text-3xl text-yellow-600 mb-3"></i>
            <div class="stat-value text-yellow-600">8</div>
            <div class="text-gray-600 font-medium">Em Rascunho</div>
            <div class="progress-bar">
                <div class="progress-fill bg-yellow-500" style="width: 18%;"></div>
            </div>
        </div>
        
        <div class="stat-card">
            <i class="fas fa-exclamation-triangle text-3xl text-red-600 mb-3"></i>
            <div class="stat-value text-red-600">5</div>
            <div class="text-gray-600 font-medium">Requer Atualização</div>
            <div class="progress-bar">
                <div class="progress-fill bg-red-500" style="width: 11%;"></div>
            </div>
        </div>
        
        <div class="stat-card">
            <i class="fas fa-users text-3xl text-blue-600 mb-3"></i>
            <div class="stat-value text-blue-600">127</div>
            <div class="text-gray-600 font-medium">Beneficiárias Atendidas</div>
            <div class="text-sm text-gray-500 mt-1">71% do total</div>
        </div>
        
        <div class="stat-card">
            <i class="fas fa-shield-alt text-3xl text-orange-600 mb-3"></i>
            <div class="stat-value text-orange-600">89</div>
            <div class="text-gray-600 font-medium">Vulnerabilidades</div>
            <div class="text-sm text-gray-500 mt-1">Identificadas</div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Gráfico de Status -->
        <div class="chart-card">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-chart-donut mr-2"></i>
                Status das Anamneses
            </h3>
            
            <div class="space-y-3">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-green-500 rounded mr-3"></div>
                        <span class="text-gray-700">Concluídas</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">32</span>
                        <span class="text-gray-500 text-sm ml-2">71%</span>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-yellow-500 rounded mr-3"></div>
                        <span class="text-gray-700">Em Rascunho</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">8</span>
                        <span class="text-gray-500 text-sm ml-2">18%</span>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <div class="w-4 h-4 bg-red-500 rounded mr-3"></div>
                        <span class="text-gray-700">Requer Atualização</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">5</span>
                        <span class="text-gray-500 text-sm ml-2">11%</span>
                    </div>
                </div>
            </div>
            
            <!-- Gráfico simples em CSS -->
            <div class="mt-6 relative">
                <div class="flex h-4 rounded-full overflow-hidden">
                    <div class="bg-green-500" style="width: 71%;"></div>
                    <div class="bg-yellow-500" style="width: 18%;"></div>
                    <div class="bg-red-500" style="width: 11%;"></div>
                </div>
            </div>
        </div>

        <!-- Vulnerabilidades Mais Frequentes -->
        <div class="chart-card">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-exclamation-triangle mr-2"></i>
                Vulnerabilidades Mais Frequentes
            </h3>
            
            <div class="space-y-4">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="vulnerability-indicator bg-red-500"></span>
                        <span class="text-gray-700">Renda/Emprego</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">24</span>
                        <div class="w-20 h-2 bg-gray-200 rounded ml-2">
                            <div class="h-2 bg-red-500 rounded" style="width: 80%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="vulnerability-indicator bg-orange-500"></span>
                        <span class="text-gray-700">Habitacional</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">18</span>
                        <div class="w-20 h-2 bg-gray-200 rounded ml-2">
                            <div class="h-2 bg-orange-500 rounded" style="width: 60%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="vulnerability-indicator bg-yellow-500"></span>
                        <span class="text-gray-700">Saúde</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">15</span>
                        <div class="w-20 h-2 bg-gray-200 rounded ml-2">
                            <div class="h-2 bg-yellow-500 rounded" style="width: 50%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="vulnerability-indicator bg-blue-500"></span>
                        <span class="text-gray-700">Educação</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">12</span>
                        <div class="w-20 h-2 bg-gray-200 rounded ml-2">
                            <div class="h-2 bg-blue-500 rounded" style="width: 40%;"></div>
                        </div>
                    </div>
                </div>
                
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <span class="vulnerability-indicator bg-purple-500"></span>
                        <span class="text-gray-700">Violência</span>
                    </div>
                    <div class="text-right">
                        <span class="font-semibold">8</span>
                        <div class="w-20 h-2 bg-gray-200 rounded ml-2">
                            <div class="h-2 bg-purple-500 rounded" style="width: 27%;"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- Atividades Recentes -->
        <div class="chart-card">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-history mr-2"></i>
                Atividades Recentes
            </h3>
            
            <div class="space-y-1">
                <div class="recent-item">
                    <div>
                        <p class="font-medium text-gray-800">Nova anamnese criada</p>
                        <p class="text-sm text-gray-600">Maria Silva - por Ana Souza</p>
                    </div>
                    <span class="text-xs text-gray-500">2h atrás</span>
                </div>
                
                <div class="recent-item">
                    <div>
                        <p class="font-medium text-gray-800">Anamnese concluída</p>
                        <p class="text-sm text-gray-600">Joana Santos - por Carla Lima</p>
                    </div>
                    <span class="text-xs text-gray-500">4h atrás</span>
                </div>
                
                <div class="recent-item">
                    <div>
                        <p class="font-medium text-gray-800">Evolução adicionada</p>
                        <p class="text-sm text-gray-600">Fernanda Costa - por Ana Souza</p>
                    </div>
                    <span class="text-xs text-gray-500">1d atrás</span>
                </div>
                
                <div class="recent-item">
                    <div>
                        <p class="font-medium text-gray-800">Vulnerabilidade identificada</p>
                        <p class="text-sm text-gray-600">Rosa Oliveira - Habitacional</p>
                    </div>
                    <span class="text-xs text-gray-500">2d atrás</span>
                </div>
                
                <div class="recent-item">
                    <div>
                        <p class="font-medium text-gray-800">Atualização necessária</p>
                        <p class="text-sm text-gray-600">Helena Ferreira - por Sistema</p>
                    </div>
                    <span class="text-xs text-gray-500">3d atrás</span>
                </div>
            </div>
            
            <div class="mt-4 text-center">
                <a href="{% url 'social:list' %}" class="text-purple-600 hover:text-purple-800 text-sm font-medium">
                    Ver todas as anamneses →
                </a>
            </div>
        </div>

        <!-- Links para Novas Funcionalidades -->
        <div class="chart-card">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-tools mr-2"></i>
                Ferramentas Avançadas
            </h3>
            
            <div class="space-y-3">
                <a href="{% url 'social:social_reports' %}" class="block p-3 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg hover:from-purple-100 hover:to-purple-200 transition-all duration-200">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-purple-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-chart-bar text-white"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Relatórios Sociais</p>
                            <p class="text-sm text-gray-600">Análises consolidadas e exportação</p>
                        </div>
                    </div>
                </a>
                
                <a href="{% url 'social:vulnerability_analytics' %}" class="block p-3 bg-gradient-to-r from-red-50 to-red-100 rounded-lg hover:from-red-100 hover:to-red-200 transition-all duration-200">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-red-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-exclamation-triangle text-white"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Analytics de Vulnerabilidades</p>
                            <p class="text-sm text-gray-600">Análise detalhada e insights</p>
                        </div>
                    </div>
                </a>
                
                <a href="{% url 'social:anamnesis-create' %}" class="block p-3 bg-gradient-to-r from-green-50 to-green-100 rounded-lg hover:from-green-100 hover:to-green-200 transition-all duration-200">
                    <div class="flex items-center">
                        <div class="w-10 h-10 bg-green-500 rounded-lg flex items-center justify-center mr-3">
                            <i class="fas fa-plus text-white"></i>
                        </div>
                        <div>
                            <p class="font-medium text-gray-800">Nova Anamnese</p>
                            <p class="text-sm text-gray-600">Wizard de criação passo a passo</p>
                        </div>
                    </div>
                </a>
            </div>
        </div>
    </div>

    <!-- Nova Seção: Indicadores de Performance -->
        <div class="chart-card">
            <h3 class="text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-chart-line mr-2"></i>
                Indicadores de Performance
            </h3>
            
            <div class="space-y-4">
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">Taxa de Conclusão</span>
                        <span class="font-semibold text-green-600">71%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-green-500" style="width: 71%;"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">Tempo Médio (dias)</span>
                        <span class="font-semibold text-blue-600">5.2</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-blue-500" style="width: 65%;"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">Beneficiárias Cobertas</span>
                        <span class="font-semibold text-purple-600">71%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-purple-500" style="width: 71%;"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">Evoluções por Caso</span>
                        <span class="font-semibold text-orange-600">2.8</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-orange-500" style="width: 56%;"></div>
                    </div>
                </div>
                
                <div>
                    <div class="flex justify-between items-center mb-2">
                        <span class="text-gray-700">Assinaturas Coletadas</span>
                        <span class="font-semibold text-teal-600">89%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill bg-teal-500" style="width: 89%;"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Ações Rápidas -->
    <div class="chart-card">
        <h3 class="text-lg font-semibold text-gray-800 mb-4">
            <i class="fas fa-bolt mr-2"></i>
            Ações Rápidas
        </h3>
        
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
            <a href="{% url 'social:anamnesis-create' %}" class="bg-purple-600 text-white p-4 rounded-lg text-center hover:bg-purple-700 transition-colors">
                <i class="fas fa-plus text-2xl mb-2"></i>
                <div class="font-medium">Nova Anamnese</div>
            </a>
            
            <a href="{% url 'social:list' %}?status=draft" class="bg-yellow-600 text-white p-4 rounded-lg text-center hover:bg-yellow-700 transition-colors">
                <i class="fas fa-edit text-2xl mb-2"></i>
                <div class="font-medium">Rascunhos</div>
            </a>
            
            <a href="{% url 'social:list' %}?status=requires_update" class="bg-red-600 text-white p-4 rounded-lg text-center hover:bg-red-700 transition-colors">
                <i class="fas fa-exclamation-triangle text-2xl mb-2"></i>
                <div class="font-medium">Atualizações</div>
            </a>
            
            <a href="{% url 'social:list' %}" class="bg-blue-600 text-white p-4 rounded-lg text-center hover:bg-blue-700 transition-colors">
                <i class="fas fa-list text-2xl mb-2"></i>
                <div class="font-medium">Ver Todas</div>
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
// Atualizar dados em tempo real (simulado)
function updateDashboard() {
    // Simular atualizações nos números
    const statValues = document.querySelectorAll('.stat-value');
    statValues.forEach(value => {
        // Adicionar uma pequena animação de contagem
        value.style.transform = 'scale(1.05)';
        setTimeout(() => {
            value.style.transform = 'scale(1)';
        }, 200);
    });
}

// Atualizar a cada 30 segundos
setInterval(updateDashboard, 30000);

// Animação de entrada dos cards
document.addEventListener('DOMContentLoaded', function() {
    const cards = document.querySelectorAll('.stat-card, .chart-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(20px)';
        
        setTimeout(() => {
            card.style.transition = 'all 0.5s ease';
            card.style.opacity = '1';
            card.style.transform = 'translateY(0)';
        }, index * 100);
    });
});

// Tooltip para barras de progresso
document.querySelectorAll('.progress-bar').forEach(bar => {
    bar.addEventListener('mouseenter', function() {
        const fill = this.querySelector('.progress-fill');
        const width = fill.style.width;
        
        const tooltip = document.createElement('div');
        tooltip.className = 'absolute bg-gray-800 text-white text-xs rounded py-1 px-2 z-10';
        tooltip.textContent = width;
        tooltip.style.top = '-30px';
        tooltip.style.left = '50%';
        tooltip.style.transform = 'translateX(-50%)';
        
        this.style.position = 'relative';
        this.appendChild(tooltip);
    });
    
    bar.addEventListener('mouseleave', function() {
        const tooltip = this.querySelector('.absolute');
        if (tooltip) {
            tooltip.remove();
        }
    });
});
</script>
{% endblock %}
